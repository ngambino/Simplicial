\documentclass[reqno,10pt,a4paper,oneside,draft]{amsart}
\setcounter{tocdepth}{1}
\usepackage{../Auxiliary/prelude}
\input{../Auxiliary/prooftree}


\title[]{A constructive version of the \\ simplicial model of univalent foundations}

\begin{document}

\begin{abstract}
We provide a partial solution to the open problem of defining constructively a model of univalent foundations in a category that is homotopically equivalent to that of topological spaces.
In particular, we prove constructive counterparts of all the main results on simplicial homotopy theory
used in the definition of Voevodsky's simplicial model of univalent foundations. The key technical ingredient
is the use of a cofibrant replacement functor to overcome the known issues regarding dependent products of fibrations.
\end{abstract}

\author{Nicola Gambino}
\address{School of Mathematics, University of Leeds, Leeds LS2 9JT, United Kingdom}
\email{n.gambino@leeds.ac.uk}


\author{Simon Henry}


 \date{\today}
 
 

\maketitle

\tableofcontents

\newpage

\section{Introduction} 


\subsection*{Context} 
\begin{itemize}
\item The problem
\item Obstructions:
\begin{itemize}
\item Minimal fibrations
\item Exponentiability of Kan complexes
\end{itemize}
\item Progress so far:
\begin{itemize}
\item Coquand and others:  
\begin{itemize}
\item cubical sets
\item uniform fibrations
\item issues: de Morgan version is known not to be equivalent to $\mathbf{Top}$.
\end{itemize}
\item Gambino and Sattler
\begin{itemize}
\item General approach; uniform fibrations
\item Gets $\Pi$-types
\item Issue: if you work algebraically, notion of fibration does not support universe; if you work non-algebraically then assumptions are not known to be constructively valid.
\end{itemize}
\item Sattler: 
\begin{itemize}
\item gets a model structure
\item same issues as Gambino-Sattler. 
\end{itemize}
\end{itemize}
\end{itemize}


\subsection*{Main results}

\begin{itemize}
\item We build on [Henry 2018]
\item General approach
\item The crucial role of cofibrancy
\item We obtain 
\begin{itemize}
\item $\Pi$-types
\item Universe
\item Univalence
\end{itemize}
\item Coherence issues:
\begin{itemize}
\item We consider them seriously
\item But they are a separate issue, left for future work
\end{itemize}
\end{itemize}






We will interpret contexts as bifibrant simplicial sets. In particular,
the empty context will be interpreted as the terminal simplicial set $1$.  Dependent types 
will be interpreted as fibrations $p \co A \to X$ where $X$ is a bifibrant simplicial and $A$ is cofibrant. In particular, types in the empty context will be interpreted as bifibrant simplicial sets. 
This choice is motivated by the fact that, for a bifibrant simplicial set $X$, the slice category~$\SSet_{/X}$ admits a weak model structure in which fibrations and cofibrations are the maps that become fibrations and cofibrations, respectively, in~$\SSet$. Then, bifibrant objects in $\SSet_{/X}$
are exactly the fibrations with codomain $X$ and cofibrant domain.



\begin{table}[htb]
\begin{tabular}{|c|c|c|c|}
\hline
& $\SSet$ & $\SSet$ & $\mathbf{CSet}$   \\ 
& \cite{voevodsky-simplicial-model} & \cite{gambino2017frobenius} & \cite{cohen-et-al:cubicaltt}   \\ \hline \hline 
Dependent type & Kan fibration & Uniform Kan fibration & Uniform Kan fibration \\ 
$\mathsf{Id}$-types & \checkmark & \checkmark  &  \checkmark  \\
$\Pi$-types & \checkmark  & \checkmark  & \checkmark  \\
Universe type & \checkmark  &  $\times$ & \checkmark  \\
Univalence axiom & \checkmark  &   $\times$ & \checkmark  \\ 
Constructive & $\times$ & \checkmark   & \checkmark  \\ 
Equivalent to $\mathbf{Top}$ &  \checkmark  & \checkmark  & $\times$  \\
Coherence & \checkmark   & \checkmark &  \checkmark  \\ 
\hline
\end{tabular}
\medskip
\caption{The univalent foundations whack-a-mole game.} 
\label{tab:whack} 
\end{table}


This paper adds a new column to~\cref{tab:whack}.

\begin{table}[htb]
\begin{tabular}{|c|c|}
\hline
& $\SSet$ \\
 \hline \hline 
 Dependent type & Kan fibration with cofibrant domain \\
 $\mathsf{Id}$-types &   \checkmark  \\
$\Pi$-types  & \checkmark  \\
Universe type & \checkmark  \\
Univalence axiom & \checkmark  \\ 
Constructive & \checkmark  \\ 
Equivalent to $\mathbf{Top}$ & \checkmark  \\
Coherence  &  ? \\ 
\hline
\end{tabular}
\medskip
\caption{The contributions of this paper.} 
\end{table}


When working constructively, fibrations as defined above maintain many of their usual classical properties,
such as stability under pullbacks. However, other properties no longer hold. For example, it is not possible to prove constructively that
for a Kan complex $B$, the simplicial set $B^A$ is a Kan complex for every simplicial set $A$. In order
to remedy this in a constructive setting, one needs some additional decidabilty assumptions, which can be 
conveniently encapsulated in the notion of a cofibration and of a cofibrant object introduced in~\cite[\S 5.1.7]{henry2018wms}, which we now recall. 


 \medskip

Having defined cofibrations and fibrations, one could try to establish the existence of a Quillen model structure by defining a trivial fibration~to be a map with the right lifting property with respect to all cofibrations, a trivial cofibration to~be a map with the left lifting property with respect to all fibrations, and a weak equivalence to be~a map that can be factored as a trivial cofibration followed by a trivial fibration. Indeed, 
these definitions are forced upon us if a Quillen model category exists. While the existence of the weak
factorisation systems is not an issue constructively (\cf comments further below), it seems  very difficult to verify the axioms for a Quillen model structure with these definitions, the key issue being  the  3-for-2 property for weak equivalences.  



\section{Preliminaries} 

Let $\catE$  be a locally cartesian closed category. For $X \in \catE$ we write $\catE_{/X}$ for the slice category over $X$. For a map $f \co Y \to X$ in $\catE$, he pullback functor as $f^* \co \catE_{/X} \to \catE_{/Y}$
and denote is action on $p \co A \to X$ as 
\[
\xymatrix{
A[f] \ar[r] \ar[d]_{p[f]} & A \ar[d]^p \\
Y \ar[r]_f & X }
\]
For a map $p \co A \to X$ in $\catE$, pullback along $p$ has both left adjoint, written $\Sigma_p \co \catE_{/A}
\to \catE_{/X}$, and a right adjoint, written $\Pi_p \co \catE_{/A} \to \catE_{/X}$. Their action on a
map $q \co B \to A$ will be written
\[
 \Sigma_p(q) \co \Sigma_A(B) \to X \, , \quad \Pi_p(q) \co \Pi_A(B) \to X \, ,
 \]
respectively. The left adjoint is defined by composition, so $\Sigma_A(B) \defeq B$ and $\Sigma_p(q) = qp$.

\medskip
For a small category $\mathbb{C}$, we write $\Psh(\mathbb{C})$ for the category of presheaves over $\mathbb{C}$ and $\yon_\mathbb{C} \co \mathbb{C} \to \Psh(\mathbb{C})$ for the Yoneda embedding. 
Recall that, for $c \in \mathbb{C}$, there is an equivalence of categories
\begin{equation}
\label{equ:pshslice}
\Psh(\mathbb{C})_{/ \yon(c)} \simeq \Psh \big(  \mathbb{C}_{/c}  \big )
\end{equation}
For $F \co {\mathbb{C}_{/c}}^{\op} \to \Set$, we write $\pi_1 \co \int F \to \yon(c)$
for the corresponding object of~$\Psh(\mathbb{C})_{/ \yon(c)}$.


\medskip



\medskip




We write $\Delta$ for the simplicial category. Its objects will be written as $[n]$, for $n \geq 0$. We denote
the category of simplicial sets, \ie the presheaf category over $\Delta$, by $\SSet$. 
 For $n \geq 0$, we write $\Delta[n]$ for for the
associated representable simplicial set. We write $i^n \co  \partial \Delta[n] \to \Delta[n]$ for the \emph{boundary inclusion} into the $n$-simplex and  $h^k_n  \co \Lambda^k[n] \to \Delta[n]$ for the $k$-th \emph{horn inclusion} into the $n$-simplex. The simplicial set $\Delta[1]$ provides an interval object in $\SSet$, with endpoint inclusions~$\kcyl \co \braces{ k} \to \Delta[1]$ defined by~$\kcyl \defeq h^1_k$.
As a special case of~\eqref{equ:pshslice} for every $[n] \in \Delta$, there is an equivalence of categories
\begin{equation}
\label{equ:psh-slice-sset}
\SSet_{/\Delta[n]} \simeq \Psh \big( \Delta_{/[n]} \big ) \, .
\end{equation}


\medskip


\noten{Something on CZF, choice of limits and colimits in $\Set$ and induced choice in $\SSet$.} 

\bigskip


We shall work  with the weak model structure on $\SSet$ introduced  in \cite[Section~5]{henry2018wms}. . 


\begin{definition}  We say that a map is a \myemph{fibration} if it has the right lifting property with respect to all the horn inclusions $h^k_n  \co \Lambda^k[n] \to \Delta[n]$, for $0 \leq k \leq n$. 
\end{definition}

We write $\Fib$ for the class of fibrations. As usual, we say that a simplicial set~$A$ is \myemph{fibrant} if 
 \ie the unique map~$A \to 1$ is a fibration.


\begin{definition} We say that  a map $f \co Y \to X$ is a \myemph{cofibration} if 
it is a levelwise complemented monomorphism and the degeneracy of the simplices of $X \setminus \mathsf{Im}(f)$ is decidable. 
\end{definition}



A simplicial set $X$ will be said to be~\myemph{cofibrant} if the unique map $0 \to X$ is a cofibration, 
\ie degeneracy of the simplices of $X$ is decidable.
We write $\Cof$ for the class of cofibrations.  Note that a map between cofibrant objects is a cofibration
if and only if it is a levelwise complemented monomorphism. 
Cofibrant simplicial sets are of particular importance for our development because of their decidability property, which can be used to establish counterparts of classical results valid for all simplicial sets. An example is the Eilenberg-Zilber lemma~\cite{henry2018wms}, asserting that in a cofibrant simplicial set~$X$, any cell $x \in X$ can be written uniquely as $p^*(y)$, where $y$ is a non-degenerate cell of $X$ and $p$ is a degeneracy. Clearly, if one assumes the law of excluded middle, then every monomorphism is a cofibration and our notion of a cofibration coincides with the usual one. 


\medskip


We say that a simplicial set is \myemph{bifibrant} if it is both fibrant and cofibrant.  We write $\Fib_{/X}$ for the full subcategory of the slice category $\SSet_{/X}$ spanned by the fibrations with codomain $X$
and $\BFFib_{/X}$ for  the full subcategory of  $\Fib_{/X}$ spanned by fibrations with cofibrant domain.





\begin{definition} \label{def:trivfib-trivcof} \hfill
\begin{enumerate}[(i)]
\item We say that a map is an \emph{trivial fibration} if it is a fibration and it has the right lifting property
with respect to every cofibration with cofibrant domain.
\item We say that a map is an \myemph{trivial cofibration} if it is a cofibration and it has the left lifting property with respect to all fibrations with fibrant codomain.
\end{enumerate}
\end{definition}

We write $\TrivCof$ and $\TrivFib$ for the classes of trivial fibrations and trivial cofibrations, respectively.
Note that, being defined by weak orthogonality conditions, the classes of trivial fibrations
and trivial cofibrations have the usual closure properties. 

\bigskip




\bigskip

As shown in~\cite[Corollary~5.3.2]{henry2018wms}, cofibrations and fibrations as defined above form  a weak model structure on the category $\SSet$, in the sense that the following conditions hold:
\begin{itemize}
\item every map $f \co A \to X$, where $A$ is cofibrant and $X$ is fibrant, can be factored as a
cofibration followed by a trivial fibration  and as a trivial cofibration followed by a trivial fibration,
\item every bifibrant object $X$ admits a strong cylinder object, \ie  a factorisation of the codiagonal $ X + X \to X$ as a cofibration followed by a fibration 
\[
\xymatrix{X + X \ar[r] &  I(X) \ar[r] & X }
\]
such that the composites $p  \iota_k \co X \to I(X)$ are trivial cofibrations,
\item every bifibrant object $X$ admits a strong path object, \ie a factorisation of the diagonal 
$X \to X \times X$ as a cofibration followed by a fibration
\[
\xymatrix{X  \ar[r]  & P(X) \ar[r] & X \times X  }
 \]
 such that the composites $P(X) \to X$ are trivial fibrations.
\end{itemize}


\medskip

We refer the reader to~\cite{henry2018wms} for the details of the proof and limit ourselves to some remarks that illustrate in what ways this weak model structure on $\SSet$ relates to the classical Quillen model structure for Kan complexes. 


\begin{remark} Let $\cal{I}$ be the set of boundary inclusions, \ie $\cal{I} \defeq \{ i^n \co  \partial \Delta[n] \to \Delta[n] \ | \ n \geq 0 \}$.  By the constructive version of the small object argument, which can be applied in this context since the 
maps in $\cal{I}$ satisfy all the finiteness and decidability assumptions discussed  in~\cite[\S 4.1.4]{henry2018wms}, there is a weak factorisation system $\big( \mathsf{Sat}(\cal{I}) \, , \cal{I}^\pitchfork \big)$
on $\SSet$. As shown in~\cite[Proposition 5.1.7]{henry2018wms} a map is a cofibration if and only if it is in $\mathsf{Sat}(\cal{I})$. Furthermore, since the domains of the boundary inclusions are cofibrant simplicial sets, trivial fibrations have the right lifting property with respect to all maps in $\cal{I}$ and therefore we have
\[
\big( \Cof, \TrivFib \big) = \big( \mathsf{Sat}(\cal{I}) \, , \cal{I}^\pitchfork \big) \, .
\]
In particular, trivial fibrations have the right lifting property with respect to \emph{all} cofibrations. Because of this, the weak factorisation system of cofibrations and trivial fibrations can be seen as our counterpart of the classical weak factorisation system of monomorphisms and trivial Kan fibrations.
\end{remark} 



\begin{remark} Let $\cal{J}$ be the set of horn inclusions, \ie $\cal{J} \defeq \{ h^k_n  \co \Lambda^k[n] \to \Delta[n]  \ | \ 0 \leq k \leq n \}$. By another application of the constructive version of the small object argument, we have another weak factorisation system $( \mathsf{Sat}(\cal{J}) \, , \cal{J}^\pitchfork)$ on $\SSet$ and, by the very definition of a fibration, we have $\cal{J}^\pitchfork = \Fib$. Following a long tradition going back at least to~\cite{gabriel-zisman:calculus-of-fractions}, we shall refer to the maps in~$\mathsf{Sat}(\cal{J})$ as~\myemph{anodyne extensions}. It follows easily from the definitions that 
\[
  \mathsf{Sat}(\cal{J}) \subseteq \TrivCof  \, .
\]
To the best of our knowledge, it is not known constructively whether $\TrivCof \subseteq \Sat(\cal{J})$. The question is intimately connected to that of whether it is possible to establish constructively the existence of a
Quillen model structure on $\SSet$ with fibrations and cofibrations as above. We discuss this question further in~\cref{sec:conclusions}.

The main reason for using the name `trivial fibration' for the the maps with the left lifting property with respect to the cofibrations with cofibrant domain, as we did in~\cref{def:trivfib-trivcof}, rather than for the anodyne extensions, which are the maps with the left lifting property with respect to all fibrations is that
 trivial cofibrations as defined here interact well with that of a weak equivalence, in the sense that it
 possible to show that a  cofibration with cofibrant domain is a trivial cofibration if and only if it is a weak equivalence, while we do not not whether a cofibration with cofibrant domain is an anodyne extension if
 and only if it is a weak equivalence. Reassuringly, if it turns out that there is a Quillen model structure on $\SSet$ then the trivial cofibrations as defined here will have to coincide with the anodyne extensions, so no conflict of terminology would arise. 
 \end{remark}








\medskip



\noten{Some material on weak equivalences to be added. It is important to note the similarities and differences between weak model structures and model
structures.}


\medskip


Recall that in a weak model category  a  cofibration with cofibrant domain is a trivial cofibration if and only if it is a weak equivalence and, dually,  a fibration with fibrant codomain is a trivial fibration if and only if it is a  weak equivalence~\cite[Proposition 2.2.9]{henry2018wms}. In the special case of simplicial sets one can prove a bit more,
thanks to the fact that every cofibrant object has a strong cylinder, given by~$A + A \rightarrowtail \Delta[1] \times A \rightarrow A$.
 


\begin{lemma}\label{lemma:triv_fib_are_we}
A trivial fibration between cofibrant simplicial sets is a weak equivalence.
In particular, any weak equivalence between cofibrant simplicial set can be factored as an acyclic cofibration followed by a trivial fibration.
\end{lemma}

\begin{proof}
Let $p \co B \to A$ be a trivial fibration between cofibrant objects. One will show that $p$ is invertible in the homotopy category by constructing first a section $i \co X \rightarrow A$ of $p$ and then a homotopy between $i  p \co A \to A$ and the identity $1_{A}$. They are obtained as diagonal filling in the following two squares:
\[
\xymatrix{0 \ar[r] \ar[d] & A \ar[d]^{p} \\ 
X \ar@{.>}[ur]^{i} \ar@{=}[r] & X}
\qquad
\xymatrix{A + A \ar[rr]^{(1_{A} , i  p)} \ar[d] & &  A \ar[d] \\ \Delta[1] \times A \ar@{.>}[rru] \ar[r]& A \ar[r]^{p} & X  }
\]
It follows that if $f \co A \rightarrow B$ is a weak equivalences between two cofibrant objects then if one factors it as a cofibration followed by a trivial fibration, the cofibration part is also an acyclic cofibration by $2$-out-of-$3$ for weak equivalences.
\end{proof}






 
\section{The cofibrant replacement functor}

The goal of this section is to give a more explicit description of the cofibrant replacement functor on simplicial sets.


\begin{definition}

\begin{enumerate}
\item[]
\item If $x \in X([n])$ is an $n$-cell in a simplicial set $X$, the \emph{degeneracy type} of $x$ is the set of face maps $\delta:[i] \rightarrow [n]$ such that $\delta^* x$ is a degenerate cell.

\item By a ``degeneracy type'', or ``degeneracy $n$-type'' we mean a subset of faces of $\Delta[n]$ that can appear as the degeneracy type of an $n$-cell of a simplicial sets.

\end{enumerate}

\end{definition}

We will construct a ``simplicial set of degeneracy type $D$''. We start with a simplicial set $D_0$ whose $n$-cells are all the subset of the faces of $\Delta[n]$, i.e. subsets of the set of finite subsets of $[n]$. If $f : [m] \rightarrow [n]$ and $P \in D_0([n])$ one defines $f^* P$ as the set of faces  $[i] \rightarrow [m]$ such that the composite $[i] \rightarrow [m] \overset{f}{\rightarrow} [n]$ is either in $P$ or non-injective.

\begin{lemma}
$D_0$ is a simplicial set, and for any simplicial set $X$, the map $X \rightarrow D_0$ sending each $n$ cell to its degeneracy type is a simplicial map preserving and detecting degeneracy.
\end{lemma}

\begin{proof}
It is immediate to check that $D_0$ is a simplicial set. Let $x \in X([n])$ and $f:[m] \rightarrow [n]$, in order to check that the maps $X \rightarrow D_0$ sending each cell to its degeneracy type is simplicial, one need to check that the degeneracy type of $f^* x$ is indeed described from the degeneracy type of $x$ using the formula for the functoriality of $D_0$. For face maps $[i] \rightarrow [m]$ the cell $i^* f^* x$ is degenerated as soon as $f \circ i$ is non injective, and if $f\circ i$ is injective, then it depends on whether $f \circ i$ is in the degeneracy type of $x$ or not.

If $f:[n] \rightarrow [m]$ is non-injective then for any $s \in D_0([m])$ the identity map $[n] \rightarrow [n]$ is in $f^* s$. So a degenerate cell of $D_0$ always contains the maximal face. In particular the map $X \rightarrow D_0$ constructed above send non-degenerate cell of $X$ to non-degenerate cells of $D_0$.

\end{proof}

In particular, the lemma construct a map $P:D_0 \rightarrow D_0$ to itself sending any cell to its degeneracy type. As $P$ preserves and detects degeneracy, it preserves the degeneracy type and hence $P \circ P =P$.

\begin{definition}
The simplicial set $D$ is the set of fix point of the idempotent $P$ acting on $D_0$.
\end{definition}

Note that for any simplicial set $X$, the map $f:X \rightarrow D_0$ sending each cell to its degeneracy type preserves the degeneracy type, hence $P f = f$. In particular a cell of $D_0$ is in $D$ if and only if it is a degeneracy type. One deduces that:

\begin{lemma}
$n$-cells of $D$ are in bijection with degeneracy $n$-type. Each simplicial set $X$ has a unique map preserving non-degeneracy to $D$, which is the map sending a cell to its degeneracy type.
\end{lemma}




We are mostly interested in degeneracy type of cofibrant simplicial set, those can easily be identified.

\begin{lemma}
A degeneracy $n$-type $s \subset Faces(\Delta[n])$ appears as the degeneracy type of a cell in a cofibrant simplicial set if and only if it is decidable (complemented) as a subset of the set of face. Decidable degeneracy type form a sub-simplicial set of $D$ which is cofibrant.
\end{lemma}

\begin{proof}
If $x$ is an $n$-cell of cofibrant simplicial set $X$, then the degeneracy type of $x$ is decidable as for each face $\delta:[i] \rightarrow [n]$ it is decidable if $\delta^* x $ is degenerated or not.
Conversely, if $X$ is any simplicial set and $x \in X$ is an $n$-cell whose degeneracy type is decidable, then the image of the map $\Delta[n] \overset{x}{\rightarrow} X$ is a cofibrant sub-simplicial set of $x$. Indeed it only contains cells of the form $f^*x$ for $f:[k] \rightarrow [n]$. For each such cell, either $f$ is injective in which can it is decidable whether $f^*x$ is degenerated or not by assumption, or $f$ is not injective in which case $f^*x$ is always degenerated. And the degeneracy type of $x$ is the same whether one see as a cell of $X$ or as a cell of this cofibrant subobject.
One immediately see that the subset of $D_0$ of decidable subset is stable under the functoriality of $D_0$ hence form decidable degeneracy types form a simplicial subobject of $D$. This sub-simplicial set has decidable equality and decidable degeneracies.
\end{proof}

\begin{lemma}

Given a map $\partial \Delta[n] \rightarrow D$ there is a unique way to extend it into map $\Delta[n] \rightarrow D$ such that the non-degenerate $n$-cell of $\Delta[n]$ is send to a non-degenerate cell.
\end{lemma}

\begin{proof}
If such an extension exists the $n$-cell $x$ corresponding to $\Delta[n] \rightarrow D$ has to be as follows: $x$ does not contains the face $[n] \rightarrow [n]$, and for all other face $\delta:[i] \rightarrow [n]$ it is in $x$ is and only the composite $[i] \rightarrow \partial \Delta[n] \rightarrow D$ is a degenerate cell. So the uniqueness is clear. We only need to show that this set is indeed a degeneracy type. But if one form $D \coprod_{\partial \Delta[n]} \Delta[n]$ then the new added $n$-cell has exactly this degeneracy type so this conclude the proof.
\end{proof}

Let $X_c \overset{\sim}{\twoheadrightarrow} X $ be the cofibrant replacement of a simplicial set $X$ constructed using Richard Garner version of the small object argument from \cite{garner:small-object-argument}.

\begin{proposition}
The map from $X_c \rightarrow D \times X$ sending an $n$-cell to its degeneracy type $s \in D$ and its image is $X$ induce a bijection between $X_c([n])$ and the set of pairs of a decidable degeneracy type $s$ and a cell of $x$ of degeneracy type larger than $s$.
\end{proposition}

\begin{proof}

Due to the ``stratified'' nature of the simplicial generating cofibration, $X_c$ can be written as the colimit of a sequence:


 \[ X^{(0)}_c \hookrightarrow X^{(1)}_c \hookrightarrow \dots \hookrightarrow X^{(n)}_c \hookrightarrow \dots \]

where $X^{(0)}_c$ is just the set of $0$-cell of $X$ and $X^{(n)}_c$ can be constructed from $X^{(n-1)}$ by taking a multiple pushout $\Delta[n] \coprod_{\partial \Delta[n]} X^{(n-1)}_c$ for each square of the form:

\[ \xymatrix{\partial \Delta[n]  \ar[r] \ar@{^{(}->}[d] & X^{(n-1)}_c \ar[d] \\ \Delta[n]  \ar[r] & X} \]

Indeed, the pushout of $\partial \Delta[n] \hookrightarrow \Delta[n]$ does not change the $k$-skeleton of $X$ for $k <n$ and the set of maps $\partial \Delta[k] \rightarrow X$ only depends on the $k$-skeleton of $X$, so one can always do all the necessary pushout by $\partial \Delta[k] \hookrightarrow \Delta[k]$ by for $k<n$ before those by $\partial \Delta[n] \hookrightarrow \Delta[n]$.


We will prove by induction on $n$ that $X^{(n)}_c$ identifies with $n$-skeleton of the simplicial set mentioned in the proposition, i.e. the sub-simplicial set $Y^n$ of $D \times X$ of pairs $(s,x)$ such $s$ is decidable,  the degeneracy type of $x$ is at least $s$ and $(s,x)$ is of dimension at most $n$, or a degeneracy of a cell of dimension at most $n$.

Note that as the degeneracy type of $x$ is larger than $s$, $s$ is the degeneracy type of the pair $(s,x)$, so the condition on $(s,x)$ being a degeneracy is equivalent to the same condition on $s$.

In the case $n=0$, there is only one degeneracy type in dimension $0$, so both $X^{(0)}_c$ and $Y^0$ are the simplicial set of cells of $X$ that are degeneracy of $0$-cells.

Assuming $Y^{n-1}$ and $X^{(n-1)}_c$ are isomorphic as claimed. One only need to check that the new non-degenerate $n$-cell that appears in $Y^{n}$ and $X^{(n)}_c$ are in bijection compatible to their boundary and their image in $X$.
In $X^{(n)}_s$ there is exactly one such cell for each square as above. In $Y^{n}$, any non-degenerate $n$-cells does produce such a square, and conversely given a square:

\[ \xymatrix{\partial \Delta[n]  \ar[r] \ar@{^{(}->}[d] & Y^{n-1} \ar[d] \\ \Delta[n]  \ar[r] & X} \]

Then the lemma above give a unique map to extend $\partial \Delta[n] \rightarrow D$ to a non-degenerate $n$-cell of $D$, and the image of $\Delta[n]$ in $X$ automatically have a larger degeneracy type that this extension so this gives a non-degenerate cell of $Y^{n}$ generating this square. This is the unique way to get such a cell in $Y^n$ to be non-degenerate: indeed a cell in $Y^n$ is non-degenerate if and only if its image in $D$ is non-degenerate.
\end{proof}


\begin{remark} 
This proposition has some interesting consequences.
\begin{itemize}
\item $1_c$ is exactly the sub-simplicial set of $D$ of decidable degeneracy type.
\item Even if $X$ is a large simplicial set, its cofibrant replacement $X_c \rightarrow X$ has fiber controlled in size: indeed the fiber over an $n$-cell $x \in X$ is the set of decidable degeneracy $n$-type smaller than the degeneracy type of $x$. In particular it is a subset of the finite set of decidable degeneracy $n$-type. Not that in order to conclude in general that the fiber are small on need some sort of propositional resizing axiom saying that a subclass of a finite set is a small set.
\end{itemize}
\end{remark}



 

\section{Pullbacks} 





 












\begin{proposition}\label{lem:cofibrant_fiber_product} \hfill 
\begin{enumerate}[$(i)$] 
\item Let $A \, , B$ be cofibrant simplicial sets. Then their product $A \times B$ is cofibrant.
\item Let $f \co A \to X$ and $g \co B \to X$ be maps with $A$ and $B$ cofibrant. Then their
fiber product $A \times_X B$, fitting in the pullback diagram
\[
\xymatrix{
A \times_X B \ar[r]^-{q} \ar[d]_-{p} & B \ar[d]^g \\
A \ar[r]_f & X \, ,}
\]
is cofibrant.
\end{enumerate}
\end{proposition}

\begin{proof} For part~(i), let $x = (a,b) \in (A \times B)_n$, if $A$ and $B$ are cofibrant one can apply the Eilenberg-Zilber lemma and write $a = p^*(a')$ and $b = q^*(b')$ with $a'$ and $b'$ non-degenerate cells and $p \co [n] \twoheadrightarrow [m]$ and $q \co [n] \twoheadrightarrow [k]$ are two degeneracies. We claim that $(a,b)$ is degenerate if and only if the map $(a ,b )  \co [n] \rightarrow [m] \times [k]$ is not monic, which is a decidable condition since $(a,b)$ is a map between finite decidable sets.

Indeed, the pair of map $(a,b)$ corresponding to a degenerate cell $x=r^*(x')$ for any non-trivial degeneracy $r \co [n] \twoheadrightarrow [n']$, is  $\big( p'(r),q'(r) \big)$ where $(p',q')$ are the maps corresponding to $x'$, and this is never monic as it factor into $r$, hence for a degenerate cell the condition above is always satisfied. Conversely, if $(p,q)\co [n] \rightarrow [m] \times [k]$ is not monic then as it is an increasing map there is some $i$ such that $p(i)=p(i+1)$ and $q(i)=q(i+1)$, hence $(p,q)$ can be factored into the $i$-th degeneracy map: $p=p' d_i$ and $q=q' d_i$ and in this case $x= d_i^* (p'^*(b'),q'^*(c'))$ is indeed a degenerate cell.


For part~(ii), $A \times_X B$ is a sub-simplicial set of $A \times B$ hence a cell of~$A \times_X B$ is degenerate if and only if it is degenerate as a cell of $A \times B$, hence degeneratness 
in~$A \times_X B$ is indeed decidable. 
\end{proof}






We use pullback functors to intepret substitution of terms into types. Given a map $f \co \Gamma' \to \Gamma$, we will show that the pullback functor $f^* \co \SSet_{/\Gamma} \to \SSet_{/\Gamma'}$ restricts to a functor
\[
f^* \co \BFFib_{/\Gamma}  \to \BFFib_{/\Gamma'} \, .
\]
It will be useful to have a special notation for the action of this functor. Given a fibration with cofibrant
domain $p \co A \to \Gamma$, we write its pullback along $f \co \Gamma' \to \Gamma$ as diagram
\[
\xymatrix{
A[f] \ar[r] \ar[d]_{p[f]} & A \ar[d]^p \\
\Gamma' \ar[r]_f & \Gamma }
\]





\begin{proposition} \label{thm:cof-pbk} Let $p \co A \to X$  be a map with cofibrant domain and codomain.
Then the pullback functor $p^* \co \SSet_{/X} \to \SSet_{/A}$ preserves cofibrations. 
\end{proposition}

\begin{proof} Let $f \co Y \to X$ be a cofibration and consider the pullback
\[
\xymatrix{
B \ar[r]^-{q} \ar@{>->}[d]_-{g} &  Y \ar@{>->}[d]^{f} \\
A \ar[r]_{p} & X}
\]
Since $A$ is cofibrant, the claim is that $g \co B \rightarrow A$ is a levelwise complemented monomorphism. For $a \in A_n$, we have that $a \in B_n$ if and only if $p(a) \in Y_n$. Since $f \co Y \rightarrow X$ is a levelwise complemented monomorphism, this is decidable.
\end{proof} 


\begin{remark} 
We conclude this section by observing that it is straightforward to define the interpretation of
$\Sigma$-types so that the computation rule and the $\eta$-rule hold as judgemental equalities. 
Let  $p \co A \to X$ be a fibration with cofibrant domain. The
functor~$\Sigma_p \co \SSet_{/A} \to \SSet_{/X}$ defined by
composition with $p$ restricts to a functor
$\Sigma_p \co \BFFib_{/A}  \to \BFFib_{/X}$
 Since fibrations are defined by a right lifting property, they are closed
under composition. Therefore, if $q \co B \to A$ is a fibration with cofibrant domain, then
$\Sigma_p(q) \co \Sigma_A(B) \to X$ is again a fibration with cofibrant domain.
\end{remark} 



\section{Identity types}

Following~\cite{awodey-warren:homotopy-idtype}, in order to interpret these rules one we need to consider
a fibration $p \co A \to X$ with cofibrant domain  and obtain a factorisation of the diagonal map $\delta_p \co A \to A \times_X A$ as a trivial cofibration $r \co A \to  \Id_A$ followed by a fibration
$(s,t) \co A \times_X A$. Note  $\Id_A$ is cofibrant, since $A$ is cofibrant and $r \co A \to \Id_A$ is a cofibration. While such a factorisation is guaranteed to exist by the axioms for a weak model category,
it is possible to make a particularly appealing choice for this factorisation, given by taking $\Id_A$ to be
the simplicial sets of paths in $A$. 

\medskip

In order to show that this is the case, we need some preliminary results. First of all, recall that
two weak factorization systems $(\Cof, \TrivFib)$ and $(\mathsf{Sat}(\cal{J}), \Fib)$
satisfy the so-called pushout-product property~\cite{henry2018wms}. More precisely, given two maps $f \co Y \rightarrow X$ and $g \co B \rightarrow A$ their \emph{pushout-product} $f \hattimes g$ is defined as the unique dotted map in
\[
\xymatrix{
Y \times B \ar[r] \ar[d] &  X \times B \ar[d] \ar@/^1.5pc/[ddr] \\
Y \times A \ar[r]  \ar@/_1.5pc/[drr] & \displaystyle \big( Y \times A ) +_{Y \times B} \big( X \times B ) \ar@{.>}[dr]  \\
 & & X \times A }
 \]
The pushout-product property is then the statement that:

\begin{itemize}
\item If $f$ and $g$ are cofibrations then so is $f \hattimes g$.
\item If additionally one of $f$ and $g$ is either anodyne or acyclic then so is $f \hattimes g$.
\end{itemize}
Note that when $f$ and $g$ are monomorphisms, so in particular when they are cofibrations, the pushout in the diagram above is just an union of subobjects and $f \hattimes g$ is just the inclusion:
\[  
(Y \times A) \cup (X \times B) \rightarrow X \times A \, .
\]






In a similar way using, but using  exponentials instead of products, for maps $f \co Y \rightarrow X$ and~$p \co B \rightarrow A$, the \myemph{pullback exponential}  $\langle f \, , p \rangle$ is defined as the unique dotted arrow in the diagram:
\[
\xymatrix{
 B^X \ar@{.>}[dr] \ar@/^1.5pc/[drr] \ar@/_1.5pc/[ddr] \\
& B^Y \times_{A^Y} A^X \ar[r] \ar[d] &  A^X \ar[d]  \\
& B^Y \ar[r] & A^Y  \\
 }
 \]
 
 \medskip
 
It is a very classical observation that an arrow $f$ has the left lifting property agains $\langle p \, , q \rangle$ if and only if $f \hattimes p$ has the left lifting property against $q$ (see for example the appendix of \cite{joyal-tierney-segal}). 

\medskip


The pushout-property immediately implies its dual version: 
\begin{itemize}
\item if $f \co Y \to X$ is a cofibration and $p \co B \to A$ a fibration then $\langle f \, , p \rangle$ is a fibration.
\end{itemize}
 Indeed for any Horn inclusion $h^k_n: \Lambda^k[n] \rightarrow \Delta[n]$ the map $h^k_n \hattimes f$ is anodyne by the pushout-product property. Therefore,  it has the left lifting property against $p$, and hence $h^k_n$ has the left lifting property against $\langle f \, , p  \rangle$, which means that   $\langle f, p \rangle$ is a fibration. By the same argument, if we  assume also either of the following:
\begin{itemize}
\item $p$ is a trivial fibration,
\item $f$ is anodyne,
\item $f$ is an acyclic cofibration and the codomain of $p$ is fibrant,
\end{itemize}
then $\langle f , p \rangle$ is a trivial fibration.  We then have the following immediate consequences of the pushout-product property.



\begin{lemma} \hfill 
 \label{thm:exponentials}
\begin{enumerate}[(i)] 
\item Let $X$ be cofibrant and $A$ be fibrant.  Then $A^X$ is fibrant.
\item Let $f \co Y \rightarrow X$ be a cofibration and $A$ be fibrant. Then $A^f \co A^X \rightarrow A^Y$ is a fibration.
\item Let $f \co Y \rightarrow X$ be a trivial cofibration and $A$ be fibrant.  Then $A^f \co A^X \rightarrow A^Y$ is a trivial fibration.
\item Let $X$ be cofibrant and $p \co B \rightarrow A$ be a (trivial) fibration. Then $p^X \co B^X \rightarrow A^X$ is also a trivial fibration.
\end{enumerate}
\end{lemma}

Part~(i) can also be established directly, by inspecting the classical proofs, exploiting the decidability of degeneracy in $X$ instead of appealing to the law of excluded middle.






\medskip



\begin{proposition} \label{thm:id-types-for-types}
Assume that $A \in \SSet$ is fibrant. Then,
\begin{enumerate}[(i)] 
\item $A^{\Delta[1]}$ is fibrant,
\item the map $(s,t) \co A^{\Delta[1]} \rightarrow A \times A$ is a fibration.
\item the composite of $(s, t) \co A^{\Delta[1]} \rightarrow A \times A$ with either projection is a trivial fibration,
\item the map $r \co A \rightarrow A^{\Delta[1]}$ induced by $\Delta[1] \rightarrow \Delta[0]$ is a weak equivalence.
\end{enumerate}
\end{proposition} 

\begin{proof}
(i) is justs part~(i) of \cref{thm:exponentials}. For (ii), apply part~(ii) of \cref{thm:exponentials} to the cofibration $\partial \Delta[1]  \hookrightarrow \Delta[1]$. For part~(iii), apply part~(iii) of \cref{thm:exponentials} to the horn inclusions $\Lambda^k[1]  \rightarrow \Delta[1]$. Part~(iv) follows from the $2$-out-of-$3$ property for weak equivalence between fibrant objects applied to $A \rightarrow A^{\Delta[1]} \rightarrow A$. Indeed, the
composite is the identity and the second factor has just been proved to be a trivial fibration.
\end{proof}


In order to have a path object, we need $A^{\Delta[1]}$ to be cofibrant and the map $r \co A \rightarrow A^{\Delta[1]}$ to be a trivial cofibration. In a general setting, these properties are not to be expected
but in the special case of $\SSet$, this is achieved by the following proposition.

\begin{proposition}\label{proposition:PathObjectCofibrant}
Let $A$ be a cofibrant simplicial set. Then the simplicial set $A^{\Delta[1]}$ is cofibrant and the map~$r \co A \rightarrow A^{\Delta[1]}$ is a cofibration.
\end{proposition}



\begin{proof}
An $n$-cell of $A^{\Delta[1]}$ is the same as a morphism $\Delta[1] \times \Delta[n] \rightarrow A$. It is classical simplicial combinatorics that $\Delta[1] \times \Delta[n]$ is a simplicial set generated by $(n+1)$ distinct non-degenerate $(n+1)$-dimensional cell $\alpha_i: \Delta[n+1] \rightarrow \Delta[1] \times \Delta[n]$ for $0 \leqslant i \leqslant n$ which are defined as (the nerve of) the map $\alpha_i$ from $\{0,\dots,(n+1)\}$ to $\{0,1\} \times \{0,\dots,n\}$ such that $\alpha_i(k)=(0,k)$ if $k \leqslant i$ and $\alpha_i(k)=(1,k-1)$ if $k>i$. They satisfies only the relation $d_i^* \alpha_i = d_{i}^* \alpha_{i-1}$ for each $1 \leqslant i \leqslant n$.

So an $n$-cell $\sigma$ of $A^{\Delta[1]}$ is the same as collection of $n+1$-cells $\sigma(\alpha_i) \in A([n])$ for $i=0,\dots,n$ subject to the relations $d_i^* \sigma \alpha_i = d_{i}^* \sigma \alpha_{i-1}$ for $i=1,\dots,n$.


It can then be checked that:

\begin{itemize}

\item $\sigma$ is ``degenerate at $j$'', i.e. is of the form $s_j ^* \sigma'$ for $s_j : [n] \rightarrow [n-1]$ the map that repeat $j$ twice if and only if for each $i$, $\sigma \alpha_i $ is degenerate at $j+1$ for $i \leqslant j+1$ and at $j$ for $i \geqslant j$ (and at both if $i=j$ of $j+1$).

\item $\sigma$ is in the image of $A \rightarrow A^{\Delta[1]}$ if and only if $\sigma(\alpha_i)$ is degenerate at $i$ for all $i$.

\end{itemize}


For example, for the second condition, if $\sigma$ is the image of an $n$-cell $t \in A[n]$ then $\sigma \alpha_i = s_i^* x$ for all $i$, and conversely, if $\sigma \alpha_i$ are all of the form $s_i^* x_i$ then the relation $d_i^* \sigma \alpha_i = d_{i}^* \sigma \alpha_{i-1}$ implies that $x_{i-1}=x_i$ for all $i$ and hence $\sigma$ is indeed the image of the cell $x=x_0= \dots = x_n$. The proof of the first claim is very similar.

Now because $A$ is cofibrant for any given cell of $A$ one can decide whether it is degenerated or not, and by which degeneracy, so these the two question above are decidable as finite conjunction of decidable questions. As $\sigma$ is degenerated if and only if it is degenerated at $j$ for some $j$ this concludes the proof.
\end{proof}


\begin{remark}
We expect the cofibrancy of $A^{\Delta[1]}$ extend to the case of $A^{X}$ when $X$ is any finite decidable simplicial set. But this is definitely not going to holds for infinite $X$ in general. So the definition of exponential will have to use the cofibrant replacement construction.
\end{remark} 


\bigskip


We now extend~\cref{thm:id-types-for-types} and~\cref{proposition:PathObjectCofibrant} 
to the case of a fibration $p \co A \rightarrow X$ with cofibrant domain and bifibrant codomain. We define $\Id_A$ 
via the pullback diagram
\[
\xymatrix{
\Id_A \ar[r] \ar[d] & A^{\Delta[1]} \ar[d] \\
X \ar[r] & X^{\Delta[1]} \\
}
\]
The structural maps $r \co A \rightarrow \Id_A$ and $(s, t) \co \Id_A \rightarrow A \times_{X} A$ are produced by the diagram:
\[
\xymatrix{
& A \ar[rr] \ar[dd] & & A^{\Delta[1]} \ar[rr] \ar[dd] & & A \times A \ar[dd] \\
A \ar[ur] \ar[rr] \ar[dd] & & \Id_A \ar[ur] \ar[rr] \ar[dd] & & A \times_{X} A \ar[ur] \ar[dd] \\
& X \ar[rr] & & X^{\Delta[1]} \ar[rr] & & X \times X \\
X \ar[ur] \ar[rr] & & X \ar[rr] \ar[ur] & & X \ar[ur] \\ 
}
\]
where the three square in the vertical/diagonal direction are pullbacks.


\begin{proposition}
\label{proposition:MainPathObject}
Assume $p \co A \rightarrow X $ is a fibration between bifibrant objects. Then,
\begin{enumerate}[(i)] 
\item $\Id_A$ is bifibrant, 
\item the map $\Id_A \rightarrow X$ is a fibration
\item the map $(s, t) \co \Id_A \rightarrow A \times_{X} A$ is a fibration,
\item the composite of $s \, , t \co \Id_A \rightarrow A \times_{X} A$  with either of the two projections is a trivial fibration,
\item the map $r \co A \rightarrow \Id_A$ is a trivial cofibration.
\end{enumerate}
\end{proposition}

\begin{proof}

The map $\Id_A \rightarrow X$ is a pullback of the maps $A^{\Delta[1]} \rightarrow X^{\Delta[1]}$ along $X \rightarrow X^{\Delta[1]}$. Hence as $A^{\Delta[1]} \rightarrow X^{\Delta[1]}$ is a fibration (by the last point of lemma \ref{thm:exponentials}), the map $\Id_A \rightarrow X$ is a fibration, in particular $\Id_A$ is fibrant. Since $X$ is cofibrant by assumption and $A^{\Delta[1]}$ is  cofibrant by \cref{proposition:PathObjectCofibrant}, we have that $\Id_A$ is also cofibrant by~\cref{lem:cofibrant_fiber_product}. 

Because of the dual of the pushout-product property, the map $\langle \partial \Delta[n] \hookrightarrow \Delta[n] ,  A \rightarrow X \rangle$ is a fibration. This map is the map:
\[ 
A^{\Delta[1]} \rightarrow (A \times A) \underset{X \times X}{\times} X^{\Delta[1]} 
\] 
Moreover in the diagram:
\[
\xymatrix{
\Id_A \ar[r] \ar[d] & A \times_{X} A \ar[d] \ar[r] & X \ar[d] \\
A^{\Delta[1]} \ar[r] & X^{\Delta[1]} \underset{X \times X}{\times} A \times A \ar[r]  & X^{\Delta[1]}
}
 \]
The right hand square is easily seen to be a pullback and the total rectangle is the pullback defining $\Id_A$, hence the left hand square is also a pullback. As we just showed that the bottom left map is a fibration, this implies that $\Id_A \rightarrow A \times_{X} A$ is a fibration as well.

A very similar argument gives that the map $\langle (\Lambda^k[n] \hookrightarrow \Delta[n]) , ( A \rightarrow X) \rangle$ (for $k=0$ or $1$) is a trivial fibration, this is a map:
\[ 
A^{\Delta[1]} \rightarrow (A) \underset{X}{\times} X^{\Delta[1]} 
\] 
which one can fit into pullback diagrams:
\[
\xymatrix{
\Id_A \ar[r] \ar[d] & A  \ar[d] \ar[r] & X \ar[d] \\
A^{\Delta[1]} \ar[r] & A \underset{X}{\times} X^{\Delta[1]} \ar[r]  & X^{\Delta[1]}
}
 \]
which this times shows that any of the two (dependings if $k=0$ or $k=1$) canonical maps $\Id_A \rightarrow A$ is a trivial fibration.

The map $A \rightarrow \Id_A$ is levelwise complemented, because it fits into a factorization 
\[
A \rightarrow \Id_A \rightarrow A^{\Delta[1]}
\] 
of a map which has been proved to be a levelwise complemented inclusion in~\cref{proposition:PathObjectCofibrant}, hence for any cell of $\Id_A$ one can decide if it is in $A$ or not by considering it as a cell of $A^{\Delta[1]}$. Since $A$ and $\Id_A$ are cofibrant, this shows that $A \rightarrow \Id_A$ is a cofibration. The $2$-out-of-$3$ property applied to $A \rightarrow \Id_A \rightarrow A$ show that  $A \rightarrow \Id_A$ is moreover a weak equivalence, hence a trivial cofibration.
\end{proof}


\section{Dependent products}
\label{sec:Pi-types}



This section is devoted to proving a counterpart of the classical result that, for a fibration $p \co A \rightarrow X$, the dependent product functor $\Pi_p \co \SSet_{/A} \to \SSet_{/X}$ preserves fibrations. For this, we 
shall concentrate on the classes of fibrations and of trivial cofibrations. 
Recall that the latter is defined to be the class of maps with the left lifting property
with respect to fibrations with fibrant codomain. Furthermore, by the general theory of weak model
structures, we know that a map with cofibrant domain is an trivial cofibration if and only if it is a cofibration
and a weak equivalence~\cite[Proposition~2.2.9]{henry2018wms}.  

\medskip

Our next proposition is essential to combine our development with that in~\cite{gambino2017frobenius}.
We need to recall some notation and terminology. For an endpoint inclusion $\kcyl \co \braces{ k } \to \Delta[1]$ and a map~$f \co Y \to X$, their $\kcyl \hattimes f$ is defined as the unique dotted arrow  in the diagram:
\[
\xymatrix{
\braces{ k } \times Y \ar[r] \ar[d] &  \Delta[1]  \times X  \ar[d] \ar@/^1.5pc/[ddr] \\
\braces{ k} \times X \ar[r]  \ar@/_1.5pc/[drr] & \big( \Delta[1] \times Y ) \cup X \ar@{.>}[dr]  \\
 & &\Delta[1] \times  X }
 \]



\begin{proposition} For a map $p \co B \to A$, the following conditions are equivalent.
\begin{enumerate}[(i)] 
\item The map $p$ is a fibration.
\item The map $p$ has the right lifting property with respect to the pushout products $ \kcyl  \hattimes f$, for every cofibration $i \co Y \to X$.
\item The map $p$ has the right lifting property with respect to the pushout products $ \kcyl  \hattimes h^n_k$, for every  
horn inclusion $h^n_k$. \noten{Need to fix indices to avoid clash of use of $k$}.
\end{enumerate}
\end{proposition} 

\begin{proof}The proof of \cite[Theorem~3.2.3]{joyal-tierney:simplicial-homotopy-theory} is completely constructive and sufficient to imply this result.
For more details, readers may also refer to the last claim in \cite[Corollary~5.3.2]{henry2018wms}
and \cite[Proposition~5.2.6]{henry2018wms}.
\end{proof}



Let $p \co A \rightarrow X$ be a fibration. By adjointness, $\Pi_p \co \SSet_{/A} \to \SSet_{/X}$  preserves fibrations if and only if the pullback functor $p^* \co \SSet_{/X} \to \SSet_{/A}$ preserves trivial cofibrations. Let us now assume  $A$ is cofibrant. 
In this case $p^*$ preserves cofibrations by \cref{thm:cof-pbk}, so we only need to show that it preserves
trivial cofibrations. We achieve this by following closely \cite[Section~3]{gambino2017frobenius}. Note that we cannot apply directly the result therein since 
the assumption that every object is cofibrant does not hold in our setting. However, only minor modifications are sufficient.


% \begin{lemma} \label{thm:missing-1}
% \hfill 
% \begin{enumerate}[(i)] 
% \item $\mathcal{J} \subset \Cof \cap \mathcal{S}$.
% \item $\Cof \cap \mathcal{S} \subseteq \TrivCof$.
% \end{enumerate}
% \end{lemma} 


\begin{definition} \label{def:strhtpyequiv} Let $k \in \braces{0 \, , 1 }$.
A map $f \co Y \rightarrow X$ in $\SSet$ is a \myemph{strong $k$-oriented homotopy equivalence} if there are maps $H$ and $H_X$ which exhibit $f$ as a retract of $\delta^k \times ' f$ as follows:

\[
\xymatrix@C=2cm{
Y \ar[d]_{f} \ar[r]^-{\delta^{1-k} \times Y} & 
( \Delta[1] \times Y ) \cup X \ar[d]^{\delta^k \times' f} \ar[r]^-{H_X} & 
Y \ar[d]^{f} \\
X \ar[r]_-{\delta^{1-k} \times X}  & 
\Delta[1] \times X \ar[r]_{H} &
X  }
\]
\end{definition}

This definition is equivalent to the one given in \cite{gambino2017frobenius} by Lemma~3.3 therein.
With this definition, it is immediate to observe that a cofibration which is a strong $k$-oriented homotopy equivalence is an anodyne morphism. Indeed, if $f \co Y \to X$ is a cofibration then $\delta^k \times ' f$ is anodyne by the pushout-product property and so $f$ is also anodyne, since it is a retract of $\delta^k \times ' f$ and hence inherits from it the
required left lifting property.

\begin{lemma}\label{lemma:genTcof_strongHequiv} \hfill 
\begin{enumerate}[$(i)$]
\item For $i < n$, the horn inclusions $h^n_i \co \Lambda^i[n] \rightarrow \Delta[n]$ are strong $0$-oriented homotopy equivalences,
\item For $0 < i $, the horn inclusions $h^n_i \co \Lambda^i[n] \rightarrow \Delta[n]$ are strong $1$-oriented homotopy equivalences.
\end{enumerate}
\end{lemma}

\begin{proof}
This is shown as part of~\cite[Theorem 3.2.3]{joyal-tierney:simplicial-homotopy-theory}. The proof given there can be easily checked to be constructive. This argument as also been reproduced (in the context of complicial sets) in the first part of the proof of \cite[Proposition~5.2.6]{henry2018wms} which is developed in constructive settings.
\end{proof}

%I've only added the reference to my paper to avoid having Joyal and Tierney's notes as unique reference for this. But If you think it is fine, you can remove it.



\begin{lemma} 
\label{lemma:pb_of_StrongHomotopyEq}
Let $p \co A \rightarrow X$ be a fibration with cofibrant domain. Then, for $k \in \{0,1\}$, 
the pullback functor $p^* \co \SSet_{/X} \to \SSet_{/A}$ preserves strong $k$-oriented homotopy equivalences.
\end{lemma}



\begin{proof} This is essentially \cite[Lemma~3.7]{gambino2017frobenius}, but we provide some details
for the convenience of the reader.
Let $f \co Y \rightarrow X$ be a strong $k$-oriented homotopy equivalence. Let $H$ and $H_X$  maps 
as in~\cref{def:strhtpyequiv}. Let $p \co A \rightarrow X$ be a fibration and consider the pullback
\[
\xymatrix@C=1.5cm{
A[f] \ar[r]^-{p^*(f)}  \ar[d]_{p_{A[f]}} & A \ar[d]^{p} \\
Y \ar[r]_{f} & X \\
}
\] 
To show that $p^*(f)$ is a strong $k$-oriented homotopy equivalence, we let $K \co \Delta[1] \times A \rightarrow A$ be a diagonal filler in the square:
\[
\xymatrix@C=1.5cm{
A \ar[d]_{\delta^{1-k}} \ar@{=}[rr] & & A \ar[d]^p \\ 
\Delta[1] \times A \ar[r]_{\Delta[1] \times p}  & \Delta[1] \times X \ar[r]_H & X
}\]
Where the map on the left-hand side is anodyne because $A$ is a cofibrant.
It remains to construct a map $K_Y$  fitting into a retract diagram of the form
\[
\xymatrix@C=1.5cm{
A[f]  \ar[d]_{p^*(f)} \ar[r] &  (\Delta[1] \times A[f])  \cup Y \ar[d]^{\delta^k \times' p^*(f)} \ar[r]^-{K_Y} & A[f] \ar[d]^{p^*(f)} \\
A \ar[r] & \Delta[1]  \times A \ar[r]_-{K} & A
}
\]
We define it using the universal property of $A[f]$ as the unique map to $A[f]$ such that the image in $X$ is the one specified by the diagram above, and the value in $Y$ is the one given by $H_X$ composed with the map $(\Delta[1] \times A[f]) \cup Y$ to $(\Delta[1] \times A[f]) \cup X$. These indeed have the same image in $X$ exactly because of the commutation of lower triangle in the filler diagram defining~$H'$. The commutation of the diagram and the fact that the upper line is a retract are immediate with this definition.
\end{proof}



\begin{proposition}\label{prop:Frobenius}
Let $p \co A \rightarrow X$ is a fibration with cofibrant domain. Then the pullback functor 
\[
p^* : \SSet_{/X} \rightarrow \SSet_{/A}
\] 
preserves cofibrations and anodyne morphisms.
\end{proposition}


\begin{proof} Since the pullback functor $p^*$ has a right adjoint,  it is enough to check that pullbacks of generating cofibrations and generating anodyne are cofibrations and anodyne, respectively. For cofibrations, this is \cref{thm:cof-pbk}. For anodyne, the anodyne morphisms in $\SSet_{/Y}$ are generated by the horn inclusions $h^k_n \co \Lambda^{k}[n] \rightarrow \Delta[n]$ for all possible choices of $\Delta[n] \rightarrow A$. By \cref{lemma:genTcof_strongHequiv} they are all strong $k$-oriented homotopy equivalences. Moreover, their pullback to $X$ is also their pullback along the map $A \times_X \Delta[n] \rightarrow \Delta[n]$ which is again a fibration with cofibrant domain by \cref{lem:cofibrant_fiber_product}. Hence  \cref{lemma:pb_of_StrongHomotopyEq} implies that the pullback 
to~$X$ are also strong $k$-oriented homotopy equivalences. Since they are cofibrations, they are anodyne by the remark just below \cref{def:strhtpyequiv}.
\end{proof}



\begin{corollary}\label{cor:Pi_types_are_fibrant}
Let $p \co A \rightarrow X$ be a fibration with cofibrant domain. The functor $\Pi_p \co \SSet_{/A} \to \SSet_{/X}$ restricts to a functor
\[
\Pi_p \co \Fib_{/A}  \to \Fib_{/X} \, .
\]

which preserves fibrations and trivial fibrations.

\end{corollary}

\begin{proof}
Since $p^*$ preserves cofibrations and anodyne morphisms. its right adjoint $p_*$ preserves fibrations and trivial fibrations. In particular, it preserves fibrant objects.
\end{proof}


Given a cofibrant simplicial set $X$ and a fibrant simplicial set, the special case of \cref{cor:Pi_types_are_fibrant} with $p$   the unique map $A \to 1$ and $q$ the second projection 
$\pi_2 \co A \times A \to A$, which is a fibration if~$A$ is a  fibrant, implies that $A^X$ is fibrant, as we already established in part~(i) 
of~\cref{thm:exponentials}. 




% \begin{theorem} 
% \label{thm:restricted-frobenius}
% The semi-model structure for Kan complexes on $\SSet$ has the restricted Frobenius condition.
% \end{theorem} 

% \begin{proof}  Since the semi-model structure in which we 
% are working is cofibrantly generated, it is sufficient [TO CHECK] that $p^*$ sends generating trivial cofibrations to trivial cofibrations. So, let $p \co B \to \Delta[n]$ be a fibration, $i \co \Lambda^k[n]
% \to \Delta[n]$ be a horn inclusion, and define $ j \defeq p^*(i)$, given by 
% the pullback diagram
% \[
% \xymatrix{
% \bullet  \ar[r] \ar[d]_j \drpullback & \Lambda^k[n] \ar[d]^{i} \\
% B \ar[r]_-{p} & \Delta[n] }
% \]
% We need to show that $j$ is a trivial cofibration.  
% First, since $i$ is a trivial cofibration, it is in particular
% a cofibration and therefore $j$ is again a cofibration by~\cref{thm:cof-pbk}. Secondly, since~$i \in \cal{J}$,
% by part~(i) of \cref{thm:missing-1}, it is a cofibration and a strong homotopy equivalence. Since its codomain is cofibrant, $j$ is a strong homotopy equivalence by~\cref{thm:missing-2}.
% But now $j$ is both a cofibration and a strong homotopy equivalence
% and hence it is a trivial cofibration, as required, by part~(ii) of \cref{thm:missing-2}.
% \end{proof} 



 


\begin{remark}[$\Pi$-types] \label{rem:pi-types}
We shall interpret $\Pi$-types via a cofibrant replacement of dependent product. In order to explain this, let
us recall that, for maps $p \co A \to X$ and $q \co B \to A$,  the dependent product $\Pi_p(q) \co \Pi_A(B)
\to X$ is equipped with a map
\[
\mathsf{app} \co \Pi_A(B) \times_A  A \to B
\] 
in $\SSet_{/A}$ which is universal in the sense that, for every  $Y \to X$, the function
\[
\begin{array}{rcl} 
 \SSet_{/X}[ Y , \Pi_A(B)] & \longrightarrow &  \SSet_{/A}[Y \times_A A, B]  \\
  f & \longmapsto & \mathsf{app}(f \times_A 1_A) 
  \end{array} 
 \]
 is a bijection. This means that we have a function $\lambda$ in the opposite direction such that  
 \begin{equation}
 \label{equ:betaeta}
 \mathsf{app}(\lambda(b) \times_A 1_A) = b   \, , \quad
 \lambda( \mathsf{app}(f \times_A 1_A)) = f \, ,
 \end{equation}
 for every $b \co Y \times_A A \to B$ and $f \co Y \to \Pi_A(B)$.  These equations correspond to the
 well-known $\beta$-rule and $\eta$-rule for $\Pi$-types, respectively.
 
 When $p$ and $q$ are fibrations and $A$ is cofibrant, the map 
 $\Pi_p(q) \co \Pi_A(B) \to X$ is a fibration by \cref{cor:Pi_types_are_fibrant} but $\Pi_A(B)$ is not cofibrant
 in general. Thus, we interpret  $\Pi$-types as the 
 cofibrant replacement  of $\Pi_A(B)$, which is given by a cofibrant simplicial set
 $\mathbb{L}(\Pi_A(B)$  equipped with
 a trivial fibration $t \co \mathbb{L}(\Pi_A(B)) \to \Pi_A(B)$. 
We then define $\widetilde{\mathsf{app}} \co   \mathbb{L}(\Pi_A(B)) \times_A A \to B$ by letting
\[
\widetilde{\mathsf{app}}  = \mathsf{app} \circ (t \times_A 1_A) \, .
\]
For a bifibrant simplicial set $Y$ and maps $Y \to X$,  $b \co Y \times_A A \to B$, we define $\widetilde{\lambda}(b) \co Y \to \mathbb{L}(B^A)$ to be the
diagonal filler
\[
\xymatrix{
0 \ar[r] \ar[d] & \mathbb{L}(\Pi_A(B))  \ar[d]^t \\
Y \ar[r]_{\lambda(b)} \ar@{.>}[ur] & \Pi_A(B)}
\]
which exists since $Y$ is cofibrant and $t$ is a trivial fibration. It follows immediately that
\[
 \widetilde{\mathsf{app}}(\widetilde{\lambda}(b) \times_A 1_A) = b \, ,
\]
so the $\beta$-rule holds as an equality. Instead, for $f \co X \to \mathbb{L}(\Pi_A(B))$, we have a homotopy
\[
\eta_f  \co \widetilde{\lambda}( \widetilde{\mathsf{app}}(f \times_A 1_A)) \sim  f  \, ,
\]
which is constructed as the diagonal filler in the following diagram
\[
\xymatrix@C=2cm{
\partial \Delta[1] \times Y \ar[r]^-{[f, \widetilde{\lambda}(f \times 1_A)]} \ar[d] & \mathbb{L}(\Pi_A(B)) \ar[d]^t \\
\Delta[1] \times Y \ar[r] \ar@{.>}[ur] & \Pi_A(B) }
\]
where the bottom map is given by the equality in the $\eta$-rule in~\eqref{equ:betaeta}.
\end{remark}



\section{The weak equivalence extension property}
\label{sec:equep}

The main goal of this section is to prove the so-called weak equivalence extension property, which will be the key to prove the existence and univalence of a weakly universal fibration.  For this, we follow closely the approach in \cite{voevodsky-simplicial-model}, but exploiting crucially the cofibrancy requirements that are part of our set-up.



\begin{lemma}\label{Lemma:ForTheExtProperty} Let $f \co Y \rightarrow X$ be a cofibration with $Y$ cofibrant. 
\begin{enumerate}[$(i)$]
\item The functor $\Pi_f \co \SSet_{/Y} \rightarrow \SSet_{/X}$ preserves trivial fibrations.
\item The counit of the adjunction $f^* \dashv \Pi_f$ is a natural isomorphism.
\item If $g \co Z \to Y$  is cofibrant in $\SSet_{/Y}$, then $\Pi_f(g) \co \Pi_f(Z) \to X$  is cofibrant in~$\SSet_{/X}$.
\item Trivial fibrations extend along cofibrations with cofibrant domain, \ie given a trivial fibration $q
 \co B \to Y$  as in the solid diagram:
\[
\xymatrix{
B \ar@{.>}[r] \ar[d]_{q} \drpullback  & A \ar@{.>}[d]^{p} \\
Y \ar[r]_f &  X \, ,}
\]
then there exists a trivial fibration $p \co A \rightarrow X$ which fits in the dotted pullback square above. Moreover if $B$ is cofibrant  then 
$A$ can be assumed to be 
cofibrant as well.
\end{enumerate}
\end{lemma}

 
\begin{proof} We prove the different parts separately. 
\begin{enumerate}[$(i)$] 
\item 

Since the functor $\Pi_f$ is the right adjoint to the pullback functor $f^*$ and trivial fibrations are the maps with the the right lifting property with respect to cofibrations between cofibrant objects, $\Pi_f$ preserves trivial fibrations if and only if $f^*$ preserve cofibration between cofibrant objects. But this follows by~\cref{thm:cof-pbk}.

\item As $f$ is a monomorphism, then the forgetful functor $\Sigma_{f} \co \SSet_{/X} \rightarrow \SSet_{/Y}$ is fully faithful and hence the unit $\eta \co 1_{\SSet_{/A}} \rightarrow f^* \Sigma_{f}$ is an isomorphism. By adjointness, the counit $\varepsilon \co f^* \Pi_f \rightarrow 1_{\SSet_{/Y}}$ is also an isomorphism.

\item \hfill 

\begin{center}
\noten{To be revised} 
\end{center}

Let $v$ be a $n$-cell in $\Pi_i(X)$.
If the image of $v$ is in $A$ then $v$ is a cell of $X \subset \Pi_i(X)$, in which case it is decidable whether $v$ is degenerate or not.
As $A$ is levelwise complemented in $B$, one can assume that $v$ is not in the image of $A$. In this case it is decidable if the image of $v$ in $B$ is degenerate or not.
Infact, by the Eilenberg-Zilber lemma one can also decide for each given degeneracy if the image of $v$ is degenerate for this precise degeneracy or not. 

Let $\sigma \co [n] \twoheadrightarrow [k]$ be any degeneracy, we will show that it is decidable whether $v$ is ``$\sigma$-degenerate, i.e. if $v =\sigma^* v'$ for some $v'$. Note that if $v$ is $\sigma$-degenerate then its image in $B$ is as well. As this is a decidable question, one can freely assume that the image of $v$ in $B$ is $\sigma$-degenerate, i.e. for the form $\sigma^* b$ for some $b \in B$ (and not in $A$).

 One can form the pullback square:


\[
\xymatrix{
V \ar@{^{(}->}[r] \drpullback \ar[d] & \Delta[n] \ar@{->}[d]^{\sigma} \\
V_{\sigma} \ar@{^{(}->}[r] \drpullback \ar[d] & \Delta[k] \ar@{->}[d]^b \\
A \ar@{^{(}->}[r] &  B }
\]

Given its image in $B$, the cell $v: \Delta[n] \rightarrow \Pi_i X$ is uniquely determined by the data of a morphism $\lambda: V\rightarrow X$. The cell $v$ is $\sigma$-degenerate if and only if $\lambda$ factors in $V_{\sigma}$ (such a factorization being unique if it exists). For any $J \subset [n]$, the $J$-face of a cell is said to be $\sigma$-degenerate if and only if it is degenerate for the (potentially trivial) degeneracy: $\sigma_{|J} : J \rightarrow \sigma(J)$. We claim that $\lambda$ factor into $V_{\sigma}$ if and only for all $i:[f] \hookrightarrow [n]$ that belong to $V$ (and $V$ is decidable so there is only a finite cardinal of them), $i^* \lambda$ is $\sigma$-degenerate (which is dediable). Indeed $V$ is the gluing of all the $\sigma \circ i$ for such faces, for each individual face $i$ one has a factorization into its image in $V_{\sigma}$ if and only if $i^* \lambda$ is $\sigma$-degenerate, and as such factorization are unique they patch together on $V_{\sigma}$ is they all exists.

\item One can simply take $p \co A \to X$ to be $\Pi_f(q) \co \Pi_f(B) \to X$. Indeed, it is a trivial fibration by part~$(i)$ and the square is a pullback by part $(ii)$. The final remark about the cofibrancy of 
$A$ follows from $(iii)$. \qedhere
\end{enumerate}
\end{proof}


\notesh{I remember we proved $(iii)$ explicitly as this was something I was worried about. But the proof above is a lot harder than in my memories. Do you have any notes about this claims ? If not just erase this note.}



\begin{proposition}[Weak equivalence extension property]
\label{Prop:Homotopy_ext_prop}
Let $p \co A \to X$ and $q \co B \to Y$ be fibrations with $Y$ fibrant and let
\[
\xymatrix{
B \ar[r] \ar[d]_q & A \ar[d]^p \\
Y \ar[r]_f & X}
\]
be a commutative diagram with $f \co Y \to X$ a cofibration and such that the canonical map
\begin{equation}
\label{equ:gluedata}
\begin{gathered}
\xymatrix{
B \ar[rr]^{u} \ar[dr] &  & A[f] \ar[dl] \\
 & Y &}
 \end{gathered}
 \end{equation}
is a weak equivalence in $\SSet_{/ Y}$. Then there exists a fibration $\bar{q} \co \bar{B} \to X$ and a weak equivalence
\[
\xymatrix{
\bar{B} \ar[rr]^{v} \ar[dr]_{\bar{q}} &  & A \ar[dl]^{p} \\
 & X &}
 \]
 in $\SSet_{/X}$ such that all the squares in the diagram
\[ 
\xymatrix{
 B
  \ar@{.>}[rr]
  \ar[dr]^{u}
  \ar[dd]_(.3){q}
&&
  \bar{B}
  \ar@{.>}[dr]^{v}
  \ar@{.>}[dd]_(.3){\bar{q}}|{\hole}
&\\&
  A[f] 
  \ar[rr]
  \ar[dl]
&&
  A
  \ar[dl]^{p}
\\
  Y
  \ar[rr]_{f}
&&
  X
&
}
\]
are pullbacks. 
\end{proposition}

\begin{proof} We define the required object $\bar{B}$ as the following pullback:
\[\xymatrix{
\bar{B} \ar[d] \ar[r] \drpullback & \Pi_Y(B) \ar[d] \\
A \ar[r]_-{\eta_{A}} & \Pi_Y \big( A[f]  \big) \, ,
}\]
where $\eta_{A}$ is  a component of the unit of adjunction  $f^* \dashv \Pi_f$. An application of the pullback functor $f^* \co \SSet_{/X} \to \SSet_{/Y}$ to this pullback square gives the commutative square
\[\xymatrix{
\bar{B}[f] \ar[d] \ar[r]  & B \ar[d] \\
A[f] \ar@{=}[r] &A[f] 
}\]
This is a pullback since $f^* \Pi_f \iso 1$ by part~(ii) \cref{Lemma:ForTheExtProperty}. Hence 
$B \iso \bar{B}[f]$, as required.


Since $B$ is cofibrant, we have that $\Pi_Y(B)$ is cofibrant by part~(iii) of  \cref{Lemma:ForTheExtProperty}. Hence, the simplicial set~$\bar{B}$  is also cofibrant by \cref{lem:cofibrant_fiber_product}. Furthermore, the maps $B \rightarrow \bar{B}$ and~$A[f] \rightarrow A$ are cofibrations by~\cref{thm:cof-pbk}, as they are pullback of the cofibration~$f \co Y \rightarrow X$.





It remains to prove that $v \co \bar{B} \rightarrow A$ is a weak equivalence and that 
$\bar{q} \co \bar{B} \rightarrow X$ is a fibration. Since, by \cref{lemma:triv_fib_are_we}, the map $u$ can be factored into a trivial cofibration followed by a trivial fibration, and our construction are functorial, it is sufficient to prove these claims when~$u$ is a trivial fibration or a trivial cofibration.

If $u$ is a trivial fibration, then its image under $f_*$ is a trivial fibration by 
part~(i) of \cref{Lemma:ForTheExtProperty}. Since the map $\bar{B} \rightarrow A$ is a pullback of this map,
it is also a trivial fibration. This also implies that the composite $\bar{B} \rightarrow A \rightarrow X$ is a fibration.


We now assume that $u \co B \rightarrow A[f]$ is a trivial cofibration. Using that the maps from $\bar{B}$ and $A[f]$ to $Y$ are fibrations between fibrant objects, we can show that $u$ is a strong deformation retract over $Y$, \ie there is a retraction $r \co A[f] \rightarrow B$ of $u$ in $\SSet_{/Y}$ and a homotopy 
\[
H \co \Delta[1] \times A[f] \rightarrow A[f]
\] 
between 
$u \circ r$ and $1_{A[f]}$, whose composite with $A[f] \rightarrow Y$ is the trivial homotopy.

We want to show that $\bar{B} \rightarrow A$ is also a deformation retract by constructing a similar homotopy 
\[
H' \co \Delta[1] \times A \rightarrow A \, .
\] 
This homotopy will be constructed so that it is $H$ on $I \times A[f]$ ,  it is the map 
\[
\Delta[1] \times \bar{B} \rightarrow \Delta[0]  \times \bar{B} \iso \bar{B} \rightarrow A
\] 
on $\Delta[0] \times \bar{B} $ (indeed they agree on $\Delta[1] \times B$) and it is the identity on $\Delta[0] \times A$.  This is achieved by taking a diagonal filling in the square:
\[
\xymatrix@C=1.5cm{
\big( \Delta[1] \times (\bar{B} \cup A[f]) \big)  \cup \big( \Delta[0] \times A \big) \ar[d] \ar[r] & A \ar[d] \\
\Delta[1] \times A \ar[r] \ar@{.>}[ur]^{H'} & X
}\]
Such a diagonall filler exists since the map on the left-hand side is a trivial cofibration, being the 
 pushout-product of $Y_0 \co \Delta[0] \rightarrow \Delta[1]$ and the cofibration $\bar{B} \cup A[f] \rightarrow A$, and the map on the right-hand side is a fibration by assumption.

It remains to see that the map $H_{1} \co A \rightarrow A$ is indeed a retraction of $\bar{B} \rightarrow A$. We already know that the restriction of $H_{1}$ to $\bar{B}$ is  the inclusion of $\bar{B}$ in $A$, so it is enough to show that $H_{1}$ has values in $\bar{B}$. We also know that $H_{1}$ restricted to $A[f]$ takes values in $B \subseteq \bar{B}$. By definition of $\bar{B}$, the map $H_1$ factor into $\bar{B}$ if and only if it takes values in $\Pi_Y(B)$ when seen as a map to $\Pi_Y(A[f])$, and by adjunction this is the case if and only if the map corresponding to $H_1$, $A[f]= f^*(A) \rightarrow A[f]$ takes values in $B$, but already mentioned above that this was indeed the case.

The fact that $\bar{B} \rightarrow A$ is a deformation retract show that it is invertible in the homotopy category, in particular it is indeed a weak equivalence. The construction above also shows that~$\bar{B}$ is retract of $A$ in $\SSet_{/X}$ and hence $\bar{q} \co \bar{B} \rightarrow X$ is a fibration because $p \co A \rightarrow X$ is.
\end{proof}

 

\section{The universe}







Our next goal is to define a bifibrant simplicial set $\U_c$ and a small fibration $\pi_c \co \UU_c \to \U_c$ that weakly classifies small fibrations between cofibrant objects, in the sense that for every such fibration $p \co A \to X$ there exists a map $a \co X \to \U_c$ such that $p$ fits in a pullback diagram of the form
\[
\xymatrix{
A \ar[r] \ar[d]_p   & \UU_c \ar[d]^{\pi_c} \\
X \ar[r]_a &  \U_c }
\]
In order to do this, we modify  the construction of the weak classifier for small fibrations 
in~\cite{voevodsky-simplicial-model} and then consider a suitable cofibrant replacement. 
We shall refer to $\U_c$ as the universe of small bifibrant objects and to $\pi_c$ as the 
weakly universal small fibration between bifibrant objects.

\begin{definition} \hfill 
\label{thm:small}
\begin{enumerate}[(i)]
\item We say that a simplicial set $X$ is \emph{small}  if $X_n$ is a small set for every $[n] \in \Delta$. 
\item We say that a map $p \co A \to X$ of simplicial sets is \emph{small} if for every $x \co \Delta[n] 
\to X$ the simplicial set~$A[x]$ given by the pullback square
\[
\xymatrix{
A[x] \ar[r] \ar[d] \drpullback & A \ar[d]^{p} \\
\Delta[n] \ar[r]_-{x} & X }
\]
is small.
\end{enumerate}
\end{definition} 





We review the definition of the weakly universal small map of simplicial sets, which
can be obtained as a special case of the results in~\cite{hofmann-streicher-universes} for arbitrary presheaf
categories. The simplicial set $\V$ is then defined by letting
\[
\mathsf{V}_n \defeq \{ F \in \Psh(\Delta_{/[n]}) \ | \ \pi_1 \co \mathsf{el}(F) \to \Delta[n] \text{ is a small
map} \}
\]
for $[n] \in \Delta$. The weakly universal small map $\rho \co \VV \to \V$ is then defined in an evident way. 
We define a subobject $\U \rightarrowtail \V$ by letting, for $[n] \in \Delta$, 
\[
\U_n = \{ F \in \V_n \ | \ \pi_1 \co \mathsf{el}(F) \to \Delta[n] \text{ is a small Kan fibration and $\mathsf{el}(F)$ is cofibrant} \} \, .
\]
We then define the map $\pi \co \UU \to \U$ via the pullback 
\[
\xymatrix{
\UU \ar[r] \ar[d]_\pi \drpullback  & \VV \ar[d]^\rho \\
\U \ar@{>->}[r] & \V }
\]




\begin{proposition} \label{thm:universe-u}  \hfill 
\begin{enumerate}[(i)] 
\item The map $\pi \co \UU \to \U$ is a small fibration.
\item For any map $a \co X \rightarrow \U$ with $X$ cofibrant, the 
simplicial set $\mathsf{T}(a)$ given by the pullback
\[
\xymatrix{
\mathsf{T}(a) \ar[r] \ar[d]_p & \UU \ar[d]^\pi \\
X \ar[r]_a & \U }
\]
is cofibrant.
\item The map $\pi \co \UU \to \U$ weakly classifies small fibrations between cofibrant object, \ie 
for every small fibration $p \co A \to X$ between cofibrant object there exists a map 
$a \co X \to \U$ and a pullback  of the form
\[
\xymatrix{
A \ar[r] \ar[d]_p \drpullback & \UU \ar[d]^\pi \\
X \ar[r]_{a} & \U }
\]
\end{enumerate}
\end{proposition}

\begin{proof} We prove the three claims separately.
\begin{enumerate}[(i)] 
\item For any map $a \co \Delta[n] \rightarrow \U$, we can consider the following pullbacks
\[
\xymatrix{
E \ar[r] \ar[d]_p  & \UU \ar[d] \ar[r]  & \VV \ar[d] \\
\Delta[n] \ar[r]_{a} & \U \ar[r]_{i} & \V }
\]
This shows that $p \co E \rightarrow \Delta[n]$ is isomorphic to $\pi_1 \co \mathrm{el}(F) \rightarrow \Delta[n]$ in $\SSet_{/ \Delta[n]}$, where $F$ corresponds under the equivalence in~\eqref{equ:pshslice} to 
$i a \co \Delta[n] \rightarrow \V$, hence by definition of $\U$, $E$ is cofibrant and $p \co E \rightarrow \Delta[n]$ is a small fibration. This implies that $\pi:\UU \rightarrow \U$ is a small map. Furthermore, $\pi$ is a fibration
since we can rewrite a general lifting problem against a horn inclusion $h^n_k \co \Lambda^k[n] \rightarrow \Delta[n]$ as follows:
\[
\xymatrix{
\Lambda^k[n] \ar[r] \ar[d]_{h^k_n} & \Delta[n]. \mathsf{T}(a)  \ar[d]^{p} \ar[r] & \UU \ar[d]^\pi \\
\Delta[n] \ar@{=}[r]  & \Delta[n] \ar[r]_a & \U  }
\]
and then use that $p \co \Delta[n]. \mathsf{T}(a)  \to \Delta[n]$ is a fibration.
\item  Let $[n] \in \Delta$, $y \in Y_n$ and define $x \defeq p(y)$. Since $X$ is cofibrant, by \cref{lem:EZ_cof} can write it in a unique way as $x=s^*(x')$, where $s \co [n] \twoheadrightarrow [k]$ is a degeneracy and 
$x' \in X_k$ is a non-degenerate cell. Let $x' \co \Delta[k] \rightarrow X$ be the corresponding map. We now form the pullback
\[
\xymatrix{
E \ar[r]^w \ar[d] \drpullback & Y \ar[r] \ar[d]_{p} \drpullback & \UU \ar[d]^\pi \\
\Delta[k] \ar[r]_{x'} & X \ar[r] & \U }
\]
By the universal property of the pullback, there is a unique cell $e \in E_n$ such that $w(e)=y$, and the image of $e$ in $\Delta[k]$ is the cell $s \co [n] \twoheadrightarrow [k]$, whose image in $X$ are both equal to $x=s^* x'$.

By definition of $\U$, the simplicial set $E$ is cofibrant and hence it is decidable whether $e$ is degenerate or not. We claim that $y$ is degenerate if and only if $e$ is, which implies that it is decidable whether $y$ is degenerate:

Indeed as $y = w(e)$ then if $e$ is degenerate so $y$ is. Conversely, assume that $y=p^*(y_1)$ for a non-trivial degeneracy $p$. Then $x=p^*(x_1)$, hence by the uniqueness part of the Eilenberg-Zilber lemma for $X$ one has that $s=q \circ p$ for some degeneracy $q$, and $x_1 = q^*(x')$. In particular, we get a unique cell $e_1$ of $E$ whose image in $\Delta[n]$ and $Y$ are  $q$ and $y_1$, respectively, whose images in $X$ are both equal to $x_1=q^*(x')$. Finally, the image of $p^*(e_1)$ in $\Delta[n]$ and~$Y$ are  $p^* y_1 =y$ and $q \circ p =s$, respectively, and hence $p^*(e_1) =e$, which proves that $e$ is degenerate as soon as $y$ is.



\item Any small map $Y \rightarrow X$ is a pullback of $\rho \co \VV \rightarrow \V$. The corresponding map $X \rightarrow \V$ factors in $U \subset V$ if and only if for every $\Delta[n] \rightarrow X$ the pullback of $Y$, $E \rightarrow \Delta[n]$ is a small fibration with $E$ cofibrant. So if $Y$ is cofibrant then $E$ is cofibrant because of~\cref{lem:cofibrant_fiber_product} and if $Y \rightarrow X$ is a small fibration then any of its pullback is also a small fibration.  \qedhere
\end{enumerate}
\end{proof} 



The simplicial sets $\U$ and $\UU$ do not appear to be cofibrant and therefore cannot be used to interpret the type universe according to our definition. However, we can consider a cofibrant replacement of $\U$, given by a cofibrant object $\U_c$ and a trivial cofibration
\begin{equation}
\label{equ:ucu}
p \co \U_c \rightarrow \U
\end{equation}
We then define $\UU_c$ via the pullback
\[
\xymatrix{
\UU_c \ar[d]_{\pi_c} \ar[r] \drpullback & \UU \ar[d]^{\pi}  \\
\U_c \ar[r]_p & \U}
\]
We now prove that $\U_c$ and $\pi_c \co \UU_c \to \U_c$ have all the desired properies by showin that 
they inherit them from $\U$ and $\pi \co \UU \to \U$.


\begin{proposition} \label{thm:universe-uc} 
\hfill 
\begin{enumerate}[(i)] 
\item $\pi_c \co \UU_c \to \U_c$ is a small fibration between fibrant objects. 
\item The map $\pi_c \co \UU_c \to \U_c$ classifies small fibrations between cofibrant objects, \ie 
for every small fibration $p \co A \to X$ with $X$ and $A$ cofibrant there exists a pullback diagram of the form
\[
\xymatrix{
A \ar[r] \ar[d]_p & \UU_c \ar[d]^{\pi_c} \\
X \ar[r]_a & \U_c }
\]
\item The object $\UU_c$ is cofibrant. \noten{Not sure we need this}
\end{enumerate}
\end{proposition}

\begin{proof} \hfill
\begin{enumerate}[(i)] 
\item The claim follows from parts~(i) and~(ii) of~\cref{thm:universe-u}. 
\item Let $p \co A \to X$ be a small fibration with $X$ cofibrant. Since $p$ is a
small fibration, we know 
from part~(iii) of \cref{thm:universe-u} that there is a pullback diagram of the form 
\[
\xymatrix{
A \ar[r] \ar[d]_p \drpullback & \UU \ar[d]^{\pi} \\
X \ar[r] & \U }
\]
Since $X$ is cofibrant, we have the lifting diagram
\[
\xymatrix{
0 \ar[r] \ar[d] & \U_c \ar[d]^{} \\
X \ar[r]_a \ar@{.>}[ur] & \U }
\]
which shows that the map $a \co X \to \U$ factors via $\U_c$.  We then obtain the diagram
\[
\xymatrix{
A \ar[r] \ar[d]_p &  \UU_c \ar[r]  \ar[d]^{\pi_c} \drpullback & \UU \ar[d]^{\pi} \\
X \ar[r]_{a_c} & \U_c \ar[r]_{a} &  \U }
\]
Here, the right-hand side square and the rectangle are pullbacks and therefore the left-hand
side square is also a pullback, as required. 
\item The claim follows from the fact that both $\U_c$ and
$\UU$ are cofibrant, the latter holding by part (iii) of~\cref{thm:universe-u}, via \cref{lem:cofibrant_fiber_product}. \qedhere
\end{enumerate} 
\end{proof} 


\notesh{
% \item Fibrancy should follow directly from equivalence extension property, without using `composition vs filling' but rather retract property for horns (see notes).
% \item Once we have established fibrancy of $U_c$, then one can prove univalence by showing that 
% $t \co \mathsf{Weq}(U_c) \to U_c$ is a trivial fibration. 
Question: do we need to know that $\mathsf{Weq}(\U_c)$ is a cofibrant object to get univalence?  I'm relatively sure $\mathsf{Weq}(\U_c)$ is not cofibrant. But all these property proved here will imediately pass to any cofibrant replacement. This is also why I'm working with  $\mathsf{Weq}(\U)$ instead: everything will be pulled back to the version for $\U_c$.
}

\section{Univalence}

\notesh{[Work in progress] I prefer to start again this section from scratch, but I'm leaving the old univalence section as long as this is not finished}


Let $p:E \twoheadrightarrow B$ be any fibration. We want to define what it means for $p$ to be a univalent fibration, and show that $\UU \twoheadrightarrow \U$ and $\UU_c \twoheadrightarrow \U_c$ are univalent fibrations.

Using the ``$\Pi$-types'' that we have already defined, one can to construct a fibration $E^{\to} \twoheadrightarrow B \times B$ that classifies morphisms between two fibers of $p$. More precisely, $E^{\to}$ is defined as $\Pi_{p \times Id_B}(E \times E)$ in:

\[
\xymatrix{
E \times E \ar[d]_{Id_E \times p } & \Pi_{p \times Id_B}(E \times E) \ar[d] \\
E \times B \ar[r]_{p \times id_B} & B \times B \\
}
\]

A morphisms from any object $A$ to $E^{\to}$ is the same as a morphism $A \overset{(f,g)}{\rightarrow} B \times B$ together with a morphism $E[f] \rightarrow E[g]$ over $A$. We now need to construct an object $Weq(p) \twoheadrightarrow E^{\to}$ that similarly classifies ``weak equivalences'' $E[f] \overset{\sim}{\rightarrow} E[g]$. we have not been able to show constructively that weak equivalences are stable under pullback along fibrations, so it is not clear if such an object $Weq(p)$ can be defined as a subobject od $E^{\to}$ or not. Instead we will follow Voevodsky's definition from type theory, see also section $4$ of \cite{shulman:reedy}, and hence one needs to start by discusing the type $\texttt{IsContr}_B(E)$

\begin{definition}
Given a fibration $p:E \twoheadrightarrow B$ one defines:

\[ \texttt{IsContr}_B(E) = \Sigma_p \Pi_{\pi_2} \Id_E  \]


With $Id_E \twoheadrightarrow E \times_B E$ and $\pi_2: E \times_B E \rightarrow E$.

\end{definition}

So $\texttt{IsContr}_B(E)$ is a fibration over $B$ which encodes the idea that the fiber of $p$ is contractible, in the sense that the data of an ``element'' of $\texttt{IsContr}_B(E)$ over a $b \in B$ is given by an element $e \in E(b)$ and for all $e' \in E(b)$ a path between $e$ and $e'$.

We now need to use this to construct an object that classifies weak equivalences. Assume one has two fibrations $E_1,E_2 \twoheadrightarrow B$ and a morphism $f$:


\[\xymatrix{
E_1 \ar@{->>}[dr] \ar[rr]^f & & E_2 \ar@{->>}[dl] \\
& B & 
}\]

We can then form the ``homotopy fiber'' of $f$ as the pullback:

\[\xymatrix{
P f \ar[d] \ar[r]  & \Id_{E_2} \ar@{->>}[d] \\
E_1 \times_B E_2 \ar[r] & E_2 \times_B E_2 
}\]

Which as usual produces a factorization of $f$:

\[E_1 \rightarrow Pf \twoheadrightarrow E_2 \]

One can then define:

\begin{definition} For any morphisms $f$ in $\Fib/B$ one defines:

\[ \texttt{IsEquiv}_B(f) = \Pi_{p_2} \texttt{IsContr}_B(Pf) \]

where $p_2$ is the fibration $E_2 \twoheadrightarrow B$.

Given $p:E \twoheadrightarrow B$ be any fibration, one defines

\[ Weq(E) = \texttt{IsEquiv}_{E^{\to}}(f) \]

Where $f$ denotes the universal map over $E^{\to}$ corresponding to its universal property.

\end{definition}

The definition of $\texttt{IsEquiv}$ formalize the idea that $f$ is an equivalence if and only all its homotopy fiber are contractible.

Admiting that the $\Pi$-types and identity types that we have defined so far are indeed part of an interpretation of type theory, i.e. that the coherence problems can be solved, these exactly corresponds to the usual definition of these notion in homotopy type theory. We now need some lemmas showing that these definitions indeed behave as expected in our model theoretic settings. These lemma mostly comes from section 4 of \cite{shulman:reedy}, though we need to reprove them to track where fibrancy/cofibrancy assumptions are needed for the proof to carry over.

\begin{lemma}\label{lem:IsContr1}For a fibration $p:E \twoheadrightarrow B$ with $E$ and $B$ bifibrant, the following are equivalent:

\begin{enumerate}
\item The map $p:E \twoheadrightarrow B$ is a trivial fibration.
\item The map $\texttt{IsContr}_B (E) \twoheadrightarrow B$ has a section.
\item There is a map $ 1 \rightarrow \Pi_B  \texttt{IsContr}_B (E) $.
\item The map $\texttt{IsContr}_B (E) \twoheadrightarrow B$ is a trivial fibration.
\end{enumerate}

\end{lemma}



More precisely, (ii) $\Rightarrow$ (i) as soon as $B$ is fibrant, (i) $\Rightarrow$ (ii) when $B$ is cofibrant and $E$ is bifibrant.
(ii) $\Leftrightarrow$ (iii) holds without assumption on $E$ and $B$, (vi) $\Rightarrow$ (ii) holds as soon as $B$ is cofibrant. And finally (i) $\Rightarrow$ (vi) holds when $E$ is bifibrant. 

\begin{proof}

A section of $\texttt{IsContr}_B (E) \twoheadrightarrow B$ is by definition of $\texttt{IsContr}_B (E)$ the data of a section $s:B \rightarrow E$, and a map $h \co E \to \Id_E$ whose image by $\Id_E \twoheadrightarrow E \times_B E$ is $(s \circ p, id_E)$. Such a section $s$ and homotopy $h$ produces a homotopy invers to $p$ and hence implies that $p$ is a weak equivalences, and hence a trivial fibration as $B$ is assumed fibrant. This proves (ii) $\Rightarrow$ (i).

Conversely, assuming (i), one can construct a section $s$ as above using the lifting property of $B$ (cofibrant) against $p$. To construct the homotopy $h$ one needs to use a lifting property of $E$ against the map $Id_E \twoheadrightarrow E \times_B E$, which is a trivial fibrations because $\Id_E \twoheadrightarrow E$ and $E\times_B E \twoheadrightarrow E$ both are and trivial fibrations satisfies $2$-out-of-$3$ among fibrations between fibrant objects.

The equivalence between (ii) and (iii) follows from the universal property of $\Pi$-types.
The implication (vi) $\Rightarrow$ (ii) is clear when $B$ is cofibrant. We conclude by showing (i) $\Rightarrow$ (vi) 

As above, as $E$ is fibrant, one can deduce assuming (i) that $\Id_E \twoheadrightarrow E \times_B E$ is a trivial fibration. $\pi_2 : E \times_B E \twoheadrightarrow E$ is a fibration with cofibrant domain, hence $\Pi_{\pi_2} \Id_E \rightarrow E$ is a trivial fibration by \cref{cor:Pi_types_are_fibrant}, and finally, $\texttt{IsContr}(E)_B \rightarrow B$ is just the composite $\Pi_{\pi_2} \Id_E \rightarrow E \rightarrow B$ so is also a trivial fibration.
\end{proof}

\begin{lemma}
Let $p: E \twoheadrightarrow B$ be a fibration, and $f:A \rightarrow B$ be a morphism. Then there is a natural isomorphisms

\[ \texttt{IsContr}_A(E[f]) \simeq \texttt{IsContr}_B(E) [f] \]

In particular, if $E$ is cofibrant and $A$ bifibrant, then the following conditions are equivalent: 

\begin{enumerate}

\item $E[f] \twoheadrightarrow A$ is a trivial fibration.

\item The maps $A \rightarrow B$ factors as $A \rightarrow \texttt{IsContr}_B(E) \rightarrow B$.

\end{enumerate}

\end{lemma}

\begin{proof}

The stability of $\texttt{IsContr}$ under pullback is a very formal property which follows from the similar stability property of $\Pi$-types, which in turn is automatic from their universal property (see for example lemma 4.2 in \cite{shulman:reedy}). The equivalence is an immediate consequence of this pullback stability and \cref{lem:IsContr1}.

\end{proof}



\section{Univalence (Obsolete)} 

In order to validate the univalence axiom for the type universe $\U$, we shall prove that the small fibration 
$\pi_c \co \UU_c \to \U_c$ is univalent. For this, we shall exploit crucially that we have a weak model
structure rather than just two weak factorisation systems.






 Let $\U^{\rightarrow}$ be the simplicial set whose $n$-cells are given by triples $(F_0, F_1, \phi)$ where
 $F_0$ and $F_1$ are $n$-cells of $\U$, \ie functors
 \[
F_1, F_2 \co {\Delta_{/[n]}}^{\op} \rightarrow \Set
\]
and $\phi \co F_1 \Rightarrow F_2$ is a natural transformation. We define the subobject $\mathsf{Weq}(\U) \subseteq \U^{\rightarrow}$ as consisting of the 
$n$-cells $(F_1, F_2, \phi) \co \Delta[n] \rightarrow \U^{\rightarrow}$ such that in the corresponding diagram:
\[
\xymatrix{ 
A_1 \ar[rr]^{w} \ar@{->>}[dr]_{p_1} & & A_2 \ar@{->>}[dl]^{p_2} \\
& \Delta[n] & }
\]
the map $w$ is weak equivalence. \caution{The simplicial set $\mathsf{Weq}(\U)$ is well defined because for any map $f \co X \rightarrow Y$ is the pullback functor $f^* \co \SSet_{/Y} \rightarrow \SSet_{/X}$ is always a right Quillen functor and therefore preserves weak equivalence between fibrant objects. Hence, 
$\mathsf{Weq}(\U)$ as defined here is indeed a subobject of $\U^{\rightarrow}$.}

\begin{proposition}
\label{prop:Weq_classify_Weq}
For any cofibrant object $X$, a morphism $a \co X \rightarrow \U^{\rightarrow}$ factors via the 
\caution{subobject} $\mathsf{Weq}(\U)$ if and only the map in $\SSet_{/X}$ classified by $a$ is a weak equivalence.

\end{proposition}

\begin{proof} Given $a \co X \rightarrow \U^{\rightarrow}$, let  
\[
\xymatrix{
A_1 \ar[rr]^w  \ar[dr]_{p_1} & & A_2 \ar[dl]^{p_2} \\
 & X & }
 \]
be the diagram classified by $a$.  By definition of $\mathsf{Weq}(\U)$, $a$ factors via $\mathsf{Weq}(\U)$ if and only if the pullback of $w \co A_1 \to A_2$ along any simplex $x \co \Delta[n] \rightarrow X$  is a weak equivalence. \caution{As observed above, this is indeed the case if $w$ is a weak equivalence.} Conversely,
we let $w \co A_1 \rightarrow A_2$ be a map between bifibrant objects of $\SSet_{/X}$, assume that the pullback of $w$ along every $x \co \Delta[n] \rightarrow X$ is a weak equivalence and show that $w$ is also equivalence.  We do so using  of \cite[Theorem 2.5.6]{henry2018wms} or, more precisely its reformulation in \cite[\S 2.5.7]{henry2018wms}, and show that $w$ has the weak right lifting property against all $i_n \co \partial \Delta[n] \rightarrow \Delta[n]$. Given a diagram:
\begin{equation}
\label{equ:before-pullback}
\begin{gathered}
\xymatrix{\partial \Delta[n] \ar[rr] \ar[d] & & A_1 \ar[d]^w \\
\Delta[n] \ar[rr] \ar[dr]_{x}
 & & A_2 \ar[dl] \\
& X &}  
\end{gathered}
\end{equation}
But one can then pullback everything to $\Delta[n]$:
\begin{equation}
\label{equ:after-pullback}
\begin{gathered}
\xymatrix{
\partial \Delta[n] \ar[r] \ar[d] & A_1 \times_X \Delta[n] \ar[d]^{x^*(w)} \\
\Delta[n] \ar[r] & A_2 \times_X \Delta[n]  
} 
\end{gathered}
\end{equation}
By assumption $x^*(w)$ is a weak equivalence between fibrant objects hence it has the weak right lifting property against $i^n \co \partial \Delta[n] \rightarrow \Delta[n]$ and a weak diagonal filler for~\eqref{equ:after-pullback} gives  a weak diagonal filler for~\eqref{equ:before-pullback}.
\end{proof}



\begin{proposition} \label{thm:fibrancy-of-u} \hfill 
\begin{enumerate}[(i)]
\item The map $(s, t) \co \mathsf{Weq}(\U) \rightarrow \U \times \U$ is a fibration.
\item The map $t \co \mathsf{Weq}(\U) \rightarrow \U$ is a trivial fibration.
\item The simplicial sets $\U$ and $\mathsf{Weq}(\U)$ are fibrant.
\end{enumerate}
\end{proposition}

\begin{proof}
\leavevmode
\begin{enumerate}[(i)]
\item First, we observe that $\U^{\rightarrow}$ is exactly $\Pi_p(\UU \times \UU)$, 
where $p \co \UU \times \U \rightarrow \U \times \U$ is the evident map. 
It follows from \cref{cor:Pi_types_are_fibrant} that $\U^{\rightarrow} \rightarrow \U \times \U$ is a fibration.
More precisely, \cref{cor:Pi_types_are_fibrant} implies that any pullback of  $\U^{\rightarrow} \rightarrow \U \times \U$ to a cofibrant
$X \rightarrow \U \times \U$ is a fibration (due to the cofibrancy assumption of  \cref{cor:Pi_types_are_fibrant}),
but this is sufficient to prove that $\U^{\rightarrow} \rightarrow \U \times \U$ is a fibration,
as in the argument for part~(i) of  \cref{thm:universe-u}.

We can then prove the claim in part~(i) as follows. 
Let $f \co Y \to X$ be a trivial cofibration between cofibrant objects and consider the diagram
\[ 
\xymatrix@C=1.5cm{ Y \ar[d]_f \ar[r]^-{w} & \mathsf{Weq}(\U) \ar[d] \\
X \ar[r]_-{a} & \U^{\rightarrow} }
\]
\caution{The map on the right-hand side is a monomorphism}, so ia lifting is unique if it exists. It exists if the map $\bar{w}$ in $\SSet_{/X}$ classified by $w$ is a weak equivalence. 
\caution{But its pullback $f^*(\bar{w})$  in the diagram}
\[ 
\xymatrix{ 
f^*(A_1) \ar[d]_{f^*(w)}  \ar[r]  & A_1 \ar[d]^{\bar{w}} \\
f^*(A_2) \ar[r] \ar[d]   & A_2 \ar[d] \\
Y \ar[r]_f & X }
\]
\caution{is a weak equivalence}.
Since the maps $p_i \co A_i \rightarrow X$ (for $i = 1, 2$) are fibrations with cofibrant domain, \cref{prop:Frobenius} implies that pullbacks of trivial cofibration between cofibrant objects 
\caution{along such 
a map} are trivial cofibrations. This implies that all the horizontal maps of the diagram above are weak equivalence, and so the upper right map also is. This shows that~$\mathsf{Weq}(\U) \rightarrow \U^{\rightarrow} \rightarrow \U \times \U$ is a fibration.
\item Let $f \co Y \rightarrow X$ be a cofibration between cofibrant objects and the diagonal
filling problem
\[
\xymatrix{Y \ar[d]_f \ar[r] & \mathsf{Weq}(\U) \ar[d] \\
X \ar[r] \ar@{.>}[ur]  & \U 
}
\]
By  \cref{prop:Weq_classify_Weq} this corresponds exactly to a diagram as in the equivalence extension property in \cref{Prop:Homotopy_ext_prop}. Indeed, the map $X \rightarrow \U$ gives us
$p \co A \to X$, the composite of~$Y \rightarrow  \mathsf{Weq}(\U)$ with the first projection
gives us $q \co B \to Y$, while the rest of the data and the commutativity of the square 
gives us a weak equivalence $u$ between $B$ and $A[f]$ over~$X$. The completion of this diagram claimed by \cref{Prop:Homotopy_ext_prop} is exactly what one needs to produce a diagonal filler.
\item Given the first two part of the proposition, it is sufficient to show that $\U$ is fibrant. An interesting consequence of the fact that $\mathsf{Weq}(\U) \rightarrow \U \times \U$ is fibrant is that for any cofibrant 
simplicial set $X$, given two maps $a_1 \, , a_2 \co X \rightrightarrows \U$ and a homotopy $h \co \Delta[1] \times X \rightarrow \U$ from $a_1$ to $a_2$, there is a weak equivalence in $\SSet_{/X}$ between the object classified by $a_1$ and $a_2$. Indeed, it is constructed as follows, one first take a lift:
\[
\xymatrix{ X \ar[r]^{i_1} \ar[d]_{\delta^0} & \mathsf{Weq}(\U) \ar@{->>}[d] \\
\Delta[1] \times X \ar[r]_{(a_1,h)} \ar@{.>}[ur] & \U \times \U
}
\]
Here, $i_1$ denotes a map classifying the identify of the object classified by $a_1$, and by $a_1$ in the first component of the bottom arrow we mean the composite $\Delta[1] \times X \rightarrow X \rightarrow \U$. Composing the dotted arrow with $\delta^1$ gives us a map $X \rightarrow  \mathsf{Weq}(\U)$ whose projection to~$\U \times \U$ if $(a_1,a_2)$, i.e. it classifies a weak equivalence between the objects classified by $a_1$ and $a_2$. Note that one can do the exact same thing with $\delta^0$ and $\delta^1$ exchanged to get a weak equivalence in the other direction.


We are now ready to prove that $\U$ is fibrant. A map $h^k_n \co \Lambda^k[n] \rightarrow \U $ classifies a fibration $q \co B \rightarrow \Lambda^k[n]$ with cofibrant domain. As proved in \cref{lemma:genTcof_strongHequiv}, the horn inclusions $h^k_n \co \Lambda^k [n] \rightarrow \Delta[n]$ are strong $k$-oriented homotopy equivalence and so this diagram can be extended by the retract diagram (where the precise maps depend on whether $k<n$ or $0 < k$):
\[
\xymatrix{\Lambda^k[n] \ar[d] \ar[r] & \big( \Delta[1] \times \Lambda^k[n] \big) \cup \Delta[n] \ar[d] \ar[r] & \Lambda^k[n] \ar[d]  \\
\Delta[n] \ar[r] & \Delta[1] \times \Delta[n] \ar[r] & \Delta[n] 
}\]
By the observation above, the composite map $\big( \Delta[1] \times \Lambda^k[n]  \big) \cup \Delta[n] \rightarrow \U$ in the diagram gives a solid diagram of the form
\[ 
\xymatrix{
  B
  \ar@{.>}[rr]
  \ar[dr]
  \ar@{->>}[dd]
&&
  \bar{B}
  \ar@{.>}[dr]
  \ar@{.>>}[dd]|{\hole}
&\\&
  A'
  \ar[rr]
  \ar@{->>}[dl]
&&
  A
  \ar@{->>}[dl]
\\
  \Lambda^k[n]
  \ar[rr]_{h^k_n}
&&
  \Delta[n]
&
}
\] 
So one can construct a fibration  $\bar{q} \co \bar{B} \to \Delta[n]$ with cofibrant domain whose pullback 
along~$h^k_n$ is isomorphic to $q \co B \to \Lambda^k_n$. The map $b \co \Delta[n] \rightarrow \U$ classifying $\bar{q}$ gives the lift we are looking for. More precisely, one can use $q  \co \bar{B} \to
\Delta[n]$ to construct  a map $b \co \Delta[n] \rightarrow \U$ which extend the one we started from and which classifies something isomorphic to $\bar{B}$. \qedhere
\end{enumerate}
\end{proof}



\begin{corollary} The fibration $\pi \co \UU \to \U$ is univalent.
\end{corollary}

\begin{proof} Let $\delta \co \U \to \U \times \U$ be the diagonal map of $\U$ and consider its factorisation
as a trivial cofibration $r \co \U \to \mathsf{Id}_\U$ followed by a fibration $(s,t) \co \mathsf{Id}_\U \to \U \times \U$. The evident solid diagram
\[
\xymatrix@C=1.5cm{
\U \ar[r] \ar[d]_r & \Weq(\U) \ar[d]^{t} \\
\mathsf{Id}_\U \ar[r]  \ar@{.>}[ur]_{j} &  \U \times \U }
\]
has a dotted diagonal filler $j$, since $r$ is a trivial cofibration and $t$ is a fibration by~\cref{thm:fibrancy-of-u}. The univalence of $\pi$ is the claim that $j$ is a weak equivalence. But by the 3-for-2 property applied to the diagram
\[
\noten{\text{TO BE ADDED}}
\]
this happens if and only if $t$ is a weak equivalence. Since $\U$ is fibrant, this amounts to $t$ being a trivial
fibration, which holds by part~(ii) of~\cref{thm:fibrancy-of-u}. 
\end{proof} 


\bigskip




 

\section{Conclusions}
\label{sec:conout}
\label{sec:conclusions}



\bigskip


\appendix

\section{Type-theoretic rules}

\subsection*{Identity types}


\[
\begin{gathered}
\begin{prooftree}
\Gamma \vdash A \co \type \qquad
\Gamma \vdash a \co A \qquad
\Gamma \vdash b \co A 
\justifies
\Gamma \vdash \mathsf{Id}_A(a,b) \co \type
\end{prooftree} \\[2ex]
\begin{prooftree}
a \co A 
\justifies
\mathsf{refl}(a) \co \mathsf{Id}_A(a,a)
\end{prooftree} \\[2ex]
\begin{prooftree}
\Gamma \vdash p \co \Id_A(a,b) \qquad
\Gamma, x, y \co A, z \co \Id_A(x,y) \vdash B \co \type \qquad
\Gamma, x \co A \vdash d \co B[x/y, \mathsf{refl}(x)/z] 
\justifies
\Gamma \vdash \mathsf{J}(a,b,p,d) \co B[a/x, b/y, p/z]
\end{prooftree} \\[2ex]
\begin{prooftree}
\Gamma \vdash a \co A \qquad
\Gamma, x, y \co A, z \co \Id_A(x,y) \vdash B \co \type \qquad
\Gamma, x \co A \vdash d \co B[x/y, \mathsf{refl}(x)/z] 
\justifies
\Gamma \vdash \mathsf{J}(a,a,\mathsf{refl}(a),d) = d[a/x] \co B[a/x, a/y, \mathsf{refl}(a)/z]
\end{prooftree}
\end{gathered}
\]



\subsection*{$\Sigma$-types}

\[
\begin{gathered}
\begin{prooftree}
\Gamma \vdash A \co \type \qquad
\Gamma, x \co A \vdash B \co \type
\justifies
\Gamma \vdash (\Sigma x \co A) B 
\end{prooftree}  \\[1ex]
\begin{prooftree}
\Gamma \vdash a \co A  \qquad
\Gamma \vdash b \co B[a/x] 
\justifies
\Gamma \vdash \mathsf{pair}(a,b) \co (\Sigma x \co A) B 
\end{prooftree}  \\[2ex]
\begin{prooftree}
\Gamma \vdash c \co (\Sigma x \co A) B 
\justifies
\Gamma \vdash  \pi_1(c) \co A 
\end{prooftree} \qquad
\begin{prooftree}
\Gamma \vdash c \co (\Sigma x \co A) B 
\justifies
\Gamma \vdash \pi_2(c) \co B[ \pi_1(c)/x] 
\end{prooftree} \\[2ex]
\begin{prooftree}
\Gamma \vdash a \co A  \qquad
\Gamma \vdash b \co B[a/x] 
\justifies
\Gamma \vdash \pi_1 \big( \mathsf{pair}(a,b) \big)  = a \co A
\end{prooftree}  \qquad
\begin{prooftree}
\Gamma \vdash a \co A  \qquad
\Gamma \vdash b \co B[a/x] 
\justifies
\Gamma \vdash \pi_2\big( \mathsf{pair}(a,b) \big) = b \co B[a/x]
\end{prooftree} \\[2ex]
\begin{prooftree}
\Gamma \vdash c \co (\Sigma x \co A) B 
\justifies
\Gamma \vdash  c = \mathsf{pair}(\pi_1(c), \pi_2(c))  \co   (\Sigma x \co A) B 
\end{prooftree}
\end{gathered}
\]







\subsection*{$\Pi$-types}
 
\[ 
\begin{gathered} 
\begin{prooftree}
\Gamma \vdash A \co \type \qquad
\Gamma, x \co A \vdash B \co \type
\justifies
\Gamma \vdash (\Pi x \co A) B 
\end{prooftree}  \\[2ex]
\begin{prooftree}
\Gamma, x \co A \vdash b \co B
\justifies
\Gamma \vdash (\lambda x \co A) b \co (\Pi x \co A) B 
\end{prooftree} \\[2ex]
\begin{prooftree}
\Gamma \vdash f \co (\Pi x \co A) B \quad
\Gamma \vdash a \co A 
\justifies
\Gamma \vdash \mathsf{app}(f,a) \co B[a/x]
\end{prooftree} \\[2ex]
\begin{prooftree}
\Gamma, x \co A \vdash b \co B \qquad
\Gamma \vdash a \co A 
\justifies
\Gamma \vdash \mathsf{app}( (\lambda x \co A)b, a) = b[a/x] \co B[a/x] 
\end{prooftree} \\[2ex]
\begin{prooftree}
\Gamma \vdash f \co (\Pi x \co A) B 
\justifies
\Gamma \vdash \eta_f \co \Id_{(\Pi x \co A)B} \big( f, (\lambda x \co A) \mathsf{app}(f,x)\big)
\end{prooftree}
\end{gathered}
\]






\subsection*{Universe type}


\[
\U \co \type \qquad 
\begin{prooftree}
\Gamma \vdash a \co \U
\justifies
\Gamma \vdash \mathsf{T}(a) \co \type
\end{prooftree}
\]


\bibliographystyle{plain}
\bibliography{../Auxiliary/bibliography}

\end{document}



