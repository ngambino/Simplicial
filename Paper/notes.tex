\documentclass[reqno,10pt,a4paper,oneside,draft]{amsart}
\setcounter{tocdepth}{1}
\usepackage{../Auxiliary/prelude}
\input{../Auxiliary/prooftree}


\title[]{Towards a constructive version of the \\ simplicial model of univalent foundations}

\begin{document}

\begin{abstract}
Some notes on simplicial homotopy theory
\end{abstract}

\author{Nicola Gambino}

\author{Simon Henry}


 \date{\today}

\maketitle

\section{Introduction}

\newpage


\section{Background}


\begin{itemize}
\item Basics on $\SSet$ and notation. 
\item We use $\Delta[n]$, $\partial \Delta[n]$ and $h^n_k$.
\item Interval object is $\Delta[1]$. Endpoint inclusions $\kcyl \co \braces{ k} \to \Delta[1]$ are
defined by $\kcyl \defeq h^1_k$.
\end{itemize}


\begin{definition} \hfill 
\label{thm:small}
\begin{enumerate}[(i)]
\item We say that a simplicial set $X$ is \emph{small}  if $X_n$ is a small set for every $[n] \in \Delta$. 
\item We say that a map $p \co A \to X$ of simplicial sets is \emph{small} if for every $x \co \Delta[n] 
\to X$ the simplicial set~$A_x$ fitting in the pullback square
\[
\xymatrix{
A_x \ar[r] \ar[d] \drpullback & A \ar[d]^{p} \\
\Delta[n] \ar[r]_-{x} & X }
\]
is small.
\end{enumerate}
\end{definition} 

\bigskip

We write $\FFib_{/X}$ for the full subcategory of $\SSet_{/X}$ spanned by fibrations and $\BFFib_{/X}$ for the full subcategory of  $\SSet_{/X}$ spanned by fibrations with cofibrant domain. We then have inclusion
functors
\[
\xymatrix{
\BFFib_{/X} \ar@{>->}[r] &
\FFib_{/X} \ar@{>->}[r] &
\SSet_{/X} \, .}
\]


\section{Outline of the interpretation} 

In order to motivate our development, we briefly outline how an interpretation of Martin-L\"of type theory 
extended with the univalence axiom, written $\mathrm{ML(UA)}$ below, is to be defined. We shall not deal with several coherence issues, which we leave for future work. Let us begin by recalling that  $\mathrm{ML(UA)}$ has the following four forms of hypothetical judgement:
\begin{gather*}
 \Gamma \vdash A \co \type \, ,  \\ 
 \Gamma \vdash a \co A \, , \\
  \Gamma \vdash A  = B \co \type \, ,  \\
 \Gamma \vdash a = b \co A \co \type \, .
  \end{gather*}
Here, $\Gamma  = (x_1 \co A_1, \ldots, x_n \co A_n)$ is a  context of variable declarations, possibly empty. Below, we shall often conflate a type and its interpretation to keep our presentation as simple as possible.

\subsection*{Types}

Types, by which we mean types in the empty context, are interpreted as bifibrant objects in $\SSet$. For example, the unit type will be interpreted as the terminal object $1$, which is bifibrant. Elements, by which we mean elements of a type in the empty context, will be interpreted as global elements, \ie maps of the form $a \co 1 \to A$.


\subsection*{Contexts}

Contexts are interpreted as bifibrant objects in $\SSet$. In particular, we interpret the empty context as the terminal object $1 \in \SSet$. 

\subsection*{Dependent types} 

For a fixed a bifibrant object $\Gamma$, we will use the slice category~$\SSet_{/\Gamma}$
to interpret types in context~$\Gamma$ and their elements. For this, we will use the fact that the slice category~$\SSet_{/\Gamma}$ admits a weak model structure in which fibrations and cofibrations are the maps that become fibrations and cofibrations in~$\SSet$ after application of the forgetful functor 
\[
U \co \SSet_{/\Gamma} \to \SSet \, .
\] 
Types in context $\Gamma$ will be interpreted as bifibrant objects in~$\SSet_{/\Gamma}$. Since the terminal object of~$\SSet_{/\Gamma}$ is the identity $1_\Gamma \co \Gamma \to \Gamma$, an object $p \co A \to \Gamma$ is fibrant in $\SSet_{/\Gamma}$ if $p$ is a fibration in~$\SSet$. Furthermore, since the initial object of~$\SSet_{/\Gamma}$ is the unique map
$!_\Gamma \co 0 \to \Gamma$, an object~$p \co A \to \Gamma$ is cofibrant in~$\SSet_{/\Gamma}$ if $A$ is cofibrant in~$\SSet$.
Thus, the bifibrant objects of~$\SSet_{/\Gamma}$ are exactly the fibrations with codomain $\Gamma$ and cofibrant domain.

For a fixed bifibrant object $p \co A \to \Gamma$ of~$\SSet_{/\Gamma}$, sections of $p$ are used to interpret elements of the type $A$ in context $\Gamma$, as usual.

\smallskip


\subsection*{Substitution} 

We use pullback functors to intepret substitution of terms into types. Given a map $f \co \Gamma' \to \Gamma$, we will show that the pullback functor $f^* \co \SSet_{/\Gamma} \to \SSet_{/\Gamma'}$ restricts to a functor
\[
f^* \co \BFFib_{/\Gamma}  \to \BFFib_{/\Gamma'} \, .
\]
It will be useful to have a special notation for the action of this functor. Given a fibration with cofibrant
domain $p \co A \to \Gamma$, we write its pullback along $f \co \Gamma' \to \Gamma$ as diagram
\[
\xymatrix{
A[f] \ar[r] \ar[d]_{p[f]} & A \ar[d]^p \\
\Gamma' \ar[r]_f & \Gamma }
\]

\subsection*{$\mathbf{Id}$-types} Recall that the formation and introduction rule for $\Id$-types are

\[
\begin{prooftree}
\Gamma \vdash A \co \type \qquad
\Gamma \vdash a \co A \qquad
\Gamma \vdash b \co A 
\justifies
\Gamma \vdash \mathsf{Id}_A(a,b) \co \type
\end{prooftree} \qquad
\begin{prooftree}
a \co A 
\justifies
\mathsf{refl}(a) \co \mathsf{Id}_A(a,a)
\end{prooftree} \medskip
\]
Given a fibration with cofibrant domain $p \co A \to \Gamma$, we will interpret identity types on $A$ via the factorisation of the diagonal map $\delta_p \co A \to A \times_\Gamma A$ as a trivial cofibration followed by
a fibration in $\SSet_{\Gamma}$: 
\[
\xymatrix{
A \ar[r]^{r} \ar[dr] & \mathsf{Id}_A \ar[r]^-{(s,t)} \ar[d]  & A \times_\Gamma A \ar[dl]  \\
 & \Gamma &  }
\]
Note that $(s,t) \co  \mathsf{Id}_A  \to A \times_\Gamma A$ is a fibration and its domain $\Id_A$ is 
cofibrant, since $A$ is so and $r \co A \to \Id_A$ is a cofibration. 

\subsection*{$\Sigma$-types} Recall that the formation and introduction rules for $\Sigma$-types are

\[
\begin{prooftree}
\Gamma \vdash A \co \type \qquad
\Gamma, x \co A \vdash B \co \type
\justifies
\Gamma \vdash (\Sigma x \co A) B 
\end{prooftree}  \qquad
\begin{prooftree}
\Gamma \vdash a \co A  \qquad
\Gamma \vdash b \co B[a/x] 
\justifies
\Gamma \vdash \mathsf{pair}(a,b) \co (\Sigma x \co A) B 
\end{prooftree} \smallskip
\]

\noindent
It will be easy  to show that, for a fibration with cofibrant domain $p \co A \to \Gamma$, the composition 
functor~$\Sigma_p \co \SSet_{/A} \to \SSet_{/\Gamma}$, left adjoint to the pullback functor $p^*$, restricts to a functor
\[
\Sigma_p \co \BFFib_{/A}  \to \BFFib_{/\Gamma} \, .
\]
The result of applying this functor to a fibration with cofibrant domain $q \co B \to A$ will be written 
\[
\Sigma_p(q) \co \Sigma_p(B) \to \Gamma \, .
\] 
Following the usual pattern, one can interpret the introduction and elimination rules so that the
computation rule and the $\eta$-rule hold as judgemental equalities. 


\subsection*{$\Pi$-types} Recall that the formation and introduction rules for $\Pi$-types are

\[
\begin{prooftree}
\Gamma \vdash A \co \type \qquad
\Gamma, x \co A \vdash B \co \type
\justifies
\Gamma \vdash (\Pi x \co A) B 
\end{prooftree} \qquad
\begin{prooftree}
\Gamma, x \co A \vdash b \co B
\justifies
\Gamma \vdash (\lambda x \co A) b \co (\Pi x \co A) B 
\end{prooftree} \medskip
\]
We will show that given a fibration with cofibrant domain $p \co A \to \Gamma$, the pushforward functor~$\Pi_p \co \SSet_{/A} \to \SSet_{/\Gamma}$, the right adjoint to the pullback functor $f^*$, restricts to a functor
\[
\Pi_p \co \BFFib_{/A}  \to \FFib_{/\Gamma} \, .
\]
The result of applying $\Pi_p$ to a fibration with cofibrant domain $q \co B \to A$ will be written as 
\[
\Pi(q) \co \Pi_p(B) \to \Gamma \, .
\] 
The domain of this fibration is not necessarily cofibrant. To remedy this, we will consider a cofibrant replacement of $\Pi_p(B)$, given by a cofibrant object~$\mathbb{L}(\Pi_p(B))$ and a trivial fibration~$t \co \mathbb{L}(\Pi_p(B)) \to \Pi_p(B)$. The dependent product would then be interpreted as the fibration with cofibrant domain $t \circ \Pi(q) \co  \mathbb{L}(\Pi_p(B)) \to X$. The standard
computation rule holds as a judgemental equality, while the $\eta$-rule holds as a propositional equality.

\subsection*{The type universe}

Recall that the formation and elimination rule for the type universe are
\[
\U \co \type \qquad 
\begin{prooftree}
\Gamma \vdash a \co \U
\justifies
\Gamma \vdash \mathsf{El}(a) \co \type
\end{prooftree}
\]

We will interpret this by defining a bifibrant object $\U_c$ and a small fibration with cofibrant domain  $\pi_c \co \UU_c \to \U_c$ that classifies small fibrations with cofibrant domain, in a sense that for every bifibrant object $X$ and every fibration with cofibrant domain $p \co A \to \Gamma$, there exists a map $a \co \Gamma \to \U_c$
fitting into a pullback diagram of the form
\[
\xymatrix{
A \ar[r] \ar[d]_p & \UU_c \ar[d]^{\pi_c} \\
\Gamma \ar[r]_a & \U_c }
\]
In order to illuminate the connection with the syntaxt, it is convenient to introduce a special notation for pullbacks of this map. Given a bifibrant object $\Gamma$ and
a map $a \co \Gamma \to \U_c$, the pullback of $\pi_c$ along $a$ will be written 
\[
\xymatrix{
\mathsf{El}(a) \ar[r] \ar[d] & \UU_c \ar[d]^{\pi} \\
\Gamma \ar[r]_a & \U_c \, .}
\]

\subsection*{The univalence axiom} 

In order to validate the univalence axiom for the type universe $\U$, we shall prove that the small fibration 
$\pi_c \co \UU_c \to \U_c$ is univalent. For this, we shall exploit crucially that we have a weak model
structure rather than just two weak factorisation systems.


\newpage



\section{Two weak factorisation systems} 

The aim of this section is to construct two weak factorisation systems on $\SSet$. These are the counterparts in our setting of the classical weak factorisation systems of cofibrations and trivial fibrations and of trivial cofibrations and fibrations, respectively. 

For this, we use a constructive version of the small object argument, discussed in~\cite{henry2018wms}. For completeness, we give a proof. 

\begin{lemma} \label{thm:soa} Let $\mathcal{E}$ be a cocomplete category and $I$ a set of maps in $\mathcal{E}$ satisfying the following assumptions:
\begin{enumerate}[$(i)$]
\item For every $i \co A \to B$ in $I$, the functor $\mathrm{Hom}_\mathcal{E}(A, -) \co \mathcal{E} \to
\mathbf{Set}$ commites with colimits of increasing $\omega$-chains.
\item For any multiple pushout ... and any $i \co A \to B$ in $I$, the function
\[
\mathrm{Hom}(A, X) \to \mathrm{Hom}(A, X_1)
\]
is a complemented monomorphism.
\end{enumerate}
Then $(\mathrm{Sat}(I), I^\pitchfork)$ is a weak factorisation system on $\mathcal{E}$.
\end{lemma}

\begin{proof} TO BE ADDED.
\end{proof}


\bigskip




We now apply \cref{thm:soa} to obtain two weak factorisation systems on $\SSet$. For the first, 
we consider 
\[
\cal{I} \defeq \{ \inc{n} \co  \partial \Delt{n} \to \Delt{n} \ | \ n \geq 0 \}
\]
We refer to maps in $\mathcal{I}$ as boundary inclusions. 

\begin{proposition} The category $\SSet$ admits a weak factorisation system $(\mathrm{Sat}(\mathcal{I}), 
\mathcal{I}^\pitchfork)$.
\end{proposition}

\begin{proof} ONE NEEDS TO CHECK ASSUMPTIONS OF \cref{thm:soa} HOLD.
\end{proof}



Observe that  a map has the right lifting property with respect to all maps in $\mathcal{I}$
if and only if it has the right lifting property with respect to all cofibrations between cofibrant
objects. This holds since all the domains of maps in $\mathcal{I}$ are cofibrant.

\bigskip


For the second weak factorisation system, we consider 
\[
\cal{J} \defeq \{ h^k_n  \co \Lambda^n_k \to \Delt{n} \ | \ 0 \leq k \leq n \} \, .
\]
We refer to maps in $\mathcal{J}$ as horn inclusions.

\begin{proposition} The category $\SSet$ admits a weak factorisation system $(\mathrm{Sat}(\mathcal{J}, 
\mathcal{J}^\pitchfork)$.
\end{proposition}

\begin{proof} ONE NEEDS TO CHECK ASSUMPTIONS OF \cref{thm:soa} HOLD.
\end{proof}



\section{Remarks on cofibrations and fibrations}

We provide some additional information on the classes of cofibrations and fibrations. 

\bigskip

We begin with cofibrations and recall from  that the Eilenberg-Zilber lemma holds for cofibrant simplicial sets.

\begin{lemma}
\label{lem:EZ_cof}
In a cofibrant simplicial set $X$, any cell $x \in X$ can be written uniquely as $p^*(y)$ where $y$ is a non-degenerate cell of $X$ and $p$ is a degeneracy.
\end{lemma}


As shown in~~\cite[Proposition 5.1.7]{henry2018wms}, a map $f \co S \to A$ is a cofibration if and only if it is a levelwise complemented monomorphism such that the degeneracy of simplices is decidable on the complement of the image of $f$. In particular, a simplicial set is cofibrant if and only if degeneracy is decidable and cofibrations between cofibrant objects are the levelwise complemented monomorphisms.






 






\begin{lemma}\label{lem:cofibrant_fiber_product}
Let $A \, , B$ be cofibrant. Then for every pullback of the form
\[
\xymatrix{
A \times_X B \ar[r]^-{q} \ar[d]_-{p} & B \ar[d]^g \\
A \ar[r]_f & X }
\]
the simplicial set $A \times_{X} B$ is cofibrant.
\end{lemma}

\begin{proof}
We check it first in the case $X = 1$, i.e. for the product $A \times B$. Let $x = (a,b) \in (A \times B)_n$, if $A$ and $B$ are cofibrant one can apply lemma \ref{lem:EZ_cof} and write $a = p^*(a')$ and $b = q^*(b')$ with $a'$ and $b'$ non-degenerate cells and $p \co [n] \twoheadrightarrow [m]$ and $q \co [n] \twoheadrightarrow [k]$ are two degeneracies. We claim that $(a,b)$ is degenerate if and only if the map $(a ,b )  \co [n] \rightarrow [m] \times [k]$ is not monic, which is a decidable condition since $(a,b)$ is a map between finite decidable sets.

Indeed, the pair of map $(a,b)$ corresponding to a degenerate cell $x=r^*(x')$ for any non-trivial degeneracy $r \co [n] \twoheadrightarrow [n']$, is  $\big( p'(r),q'(r) \big)$ where $(p',q')$ are the maps corresponding to $x'$, and this is never monic as it factor into $r$, hence for a degenerate cell the condition above is always satisfied. Conversely, if $(p,q)\co [n] \rightarrow [m] \times [k]$ is not monic then as it is an increasing map there is some $i$ such that $p(i)=p(i+1)$ and $q(i)=q(i+1)$, hence $(p,q)$ can be factored into the $i$-th degeneracy map: $p=p' d_i$ and $q=q' d_i$ and in this case $x= d_i^* (p'^*(b'),q'^*(c'))$ is indeed a degenerate cell.


In the case where $X$ is non-trivial, $S \times_X T$ is a sub-simplicial set of $S \times T$ hence a cell of~$B \times_X T$ is degenerate if and only if it is degenerate as a cell of $S \times T$, hence degeneratness 
in~$S \times_X T$ is indeed decidable. 
\end{proof}


\begin{proposition} \label{thm:cof-pbk} Let $A ,B$ and $X$ be cofibrant, $f \co A \rightarrow X$ a cofibration and
\[
\xymatrix{
A \times_X B \ar[r]^-{q} \ar[d]_-{p} &  B \ar[d]^g \\
A \ar[r]_f & X}
\]
be a pullback diagram. Then $q \co A \times_X B \rightarrow B$ is a cofibration.
\end{proposition}

\begin{proof} Since $B$ is cofibrant, the claim is that $q \co A \times_C B \rightarrow B$ is a levelwise complemented monomorphisms. A cell $b \in B_n$ is in  $(A \times_C B)_n$ if and only if its image in $X_n$ belong to $A_n$. Since $f \co A \rightarrow X$ is a levelwise complemented monomorphism, this is decidable.
\end{proof} 



% \begin{lemma} For $0 \leq k \leq n$, the horn inclusion $\horninc{k}{n} \co \Horn{k}{n} \to \Delt{n}$ is a retract of
% the pushout product
% \[
% \horninc{k}{1} \hattimes i^n \co (\Delt{1} \times \Sphere{n} ) \cup (\braces{k} \times \Delt{n} ) \to \Delt{1} \times \Delt{n} 
% \]
% \end{lemma} 

\bigskip

We now turn our attention to fibrations. The next proposition will be essential to combine our development with that in~\cite{gambino2017frobenius}.




\begin{proposition} A map $p \co A \to X$ is a fibration if and only if it has the right lifting property with respect to the pushout products $ \kcyl  \hattimes i$, for every cofibration $i$.
\end{proposition} 

\begin{proof}The proof of \cite[Theorem~3.2.3]{joyal-tierney:simplicial-homotopy-theory} is completely constructive and sufficient to imply this result.
For more details see also the last claim of \cite[Corollary~5.3.2]{henry2018wms}, which follows from Proposition~5.2.6 therein. 
\end{proof}

\section{Weak equivalences} 

WE NEED TO CLARIFY THE DISTINCTION BETWEEN SATTLER WEAK EQUIVALENCES AND HENRY WEAK EQUIVALENCES. ALSO A GOOD PLACE TO RECALL THE EXISTENCE OF THE WEAK MODEL STRUCTURE.


\bigskip

In a general weak model category, one can only show that a map $p \co Y \to X$ is a trivial fibration
if and only if $p$ is a fibration and a weak equivalence when $X$ is fibrant. But in the special case of simplicial sets one can prove that this holds also when $X$ and $Y$ are cofibrant. This is because every cofibrant object has a strong cylinder given by $X + X \rightarrowtail \Delta[1] \times X \rightarrow X$.

\begin{lemma}\label{lemma:triv_fib_are_we}
A fibration between cofibrant simplicial sets is a weak equivalence if and only if it is a trivial fibration.
In particular, any weak equivalence between cofibrant simplicial set can be factored as a trivial cofibration followed by a trivial fibration.
\end{lemma}

\begin{proof}
One first proves that any trivial fibration  $p \co A \to X$ between cofibrant object is a weak equivalence. More precisely, one shows that $p$ is invertible in the homotopy category by constructing first a section $i \co X \rightarrow A$ of $p$ and then a homotopy between $i  p \co A \to A$ and the identity $1_{A}$. They are obtained as diagonal filling in the following two squares:
\[
\xymatrix{0 \ar[r] \ar[d] & A \ar[d]^{p} \\ 
X \ar@{.>}[ur]^{i} \ar@{=}[r] & X}
\qquad
\xymatrix{A + A \ar[rr]^{(1_{A} , i  p)} \ar[d] & &  A \ar[d] \\ \Delta[1] \times A \ar@{.>}[rru] \ar[r]& A \ar[r]^{p} & X  }
\]
It follows that if $p \co A \rightarrow X$ is a weak equivalences between two cofibrant objects then if one factors it as a cofibration followed by a trivial fibration, then the cofibration part is a trivial cofibration. 

Finally, if $p \co A \to X$ is a fibration between cofibrant objects which is also a weak equivalence then one can factor it as a trivial cofibration $j$ followed by a trivial fibration $p'$, and using the lifting property of $j$ against $p$ one obtained that $p$ is a retract of $p'$, hence a trivial fibration as well.
\end{proof}


%The following is technically speaking not really needed, but it is a nice fact and it makes lots of formulation later nicer.

\begin{corollary}
For any cofibrant simplicial set $X$, the category $\SSet_{/X}$ admits a weak model structure with cofibrations and fibrations  being those of $\SSet$.
\end{corollary}

\begin{proof}

It is clear that one has two weak factorization systems on $\SSet_{/X}$ for every object $X$. So according to \cite[Definition~2.1.11]{henry2018wms} we only have to show that bifibrant objects admits cylinder objects and path objects.

Let $Y$ be a cofibrant object of $\SSet_{/X}$. One forms a cofibration,trivial fibration factorization:
\[ 
Y +_X Y \hookrightarrow I_X(Y) \overset{\sim}{\twoheadrightarrow} Y 
\]
Since, by  \cref{lemma:triv_fib_are_we}, the trivial fibration above is a weak equivalence in $\SSet$, both legs $Y \hookrightarrow I_X(Y)$ are weak equivalences in $\SSet$ as well and hence they are trivial cofibrations. This shows that every cofibrant object admit a strong cylinder object. Similarly, let $Y$ be a bifibrant object of $\SSet_{/X}$, \ie $Y$ is cofibrant and $Y \twoheadrightarrow X$ is a fibration, then one can form a factorisation as a trivial cofibration followed by a fibration:
\[ 
Y \overset{\sim}{\hookrightarrow} P_X(Y) {\twoheadrightarrow} Y \times_{X} Y 
\]
As $Y \twoheadrightarrow X$ is a fibration, the map $Y \times_X Y \twoheadrightarrow Y$ is also a fibration, hence the map $P_X Y \twoheadrightarrow Y$ is a fibration, and as it is a retraction of the trivial cofibration $Y \hookrightarrow P_X(Y)$ it is also a weak equivalence (note that the objec $Y \times_X Y$ if cofibrant because of \cref{lem:cofibrant_fiber_product}), hence it is a trivial fibration again by \cref{lemma:triv_fib_are_we}. This proves that every bifibrant object of $\SSet_{/X}$ also has a strong path object.
\end{proof}

\newpage

\section{On the cofibrant replacement functor}

The goal of this section is to give a more explicit description of the cofibrant replacement functor on simplicial sets.


\begin{definition}
If $x \in X([n])$ is an $n$-cell in a simplicial set $X$, the degeneracy type of $x$ is the set of of faces map $\delta:[i] \rightarrow [n]$ such that $\delta^* x$ is a degenerate cell. 
By a ``degeneracy type'', or ``degeneracy $n$-type'' we mean a subset of faces of $\Delta[n]$ that can appear as the degeneracy type of an $n$-cell of a simplicial sets.
\end{definition}

We will construct a ``simplicial set of degeneracy type $D$''. We start with a simplicial set $D_0$ whose $n$-cell are all the subset of the faces of $\Delta[n]$, i.e. subsets of the set of finite subset of $[n]$. If $f : [m] \rightarrow [n]$ and $P \in D_0([n])$ one defines $f^* P$ as the set of faces  $[i] \rightarrow [m]$ such that the composite $[i] \rightarrow [m] \overset{f}{\rightarrow} [n]$ is either in $P$ or non-injective.

\begin{lemma}
$D_0$ is a simplicial set, and for any simplicial set $X$, the map $X \rightarrow D_0$ sending each $n$ cell to its degeneracy type is a simplicial map preserving and detecting degeneracy.
\end{lemma}

\begin{proof}
It is immediate to check that $D_0$ is a simplicial set. Let $x \in X([n])$ and $f:[m] \rightarrow [n]$, one need to check that the degeneracy type of $f^* x$ is indeed described from the degeneracy type of $x$ using the formula for the functoriality of $D_0$. But for face $[i] \rightarrow [m]$ the cell $i^* f^* x$ is degenerated as soon as $f \circ i$ is non injective, and if $f\circ i$ is injective, then it depends on whether $f \circ i$ is in the degeneracy type of $x$ or not.

If $f:[n] \rightarrow [m]$ is non-injective then for any $s \in D_0([m])$ the identity map $[n] \rightarrow [n]$ is in $f^* s$. So a degenerate cell of $D_0$ always contains the maximal face. In particular the map $X \rightarrow D_0$ constructed above send non-degenerate cell of $X$ to non-degenerate cells of $D_0$.

\end{proof}

In particular, the lemma construct a map from $D_0$ to itself sending any cell to its degeneracy type. As this map detects degeneracy, it preserves the degeneracy type and hence it is an idempotent endomorphisms of $D_0$. One immediately obtains:

\begin{lemma}
$n$-cells of $D$ are in bijection with degeneracy $n$-type. Each simplicial set $X$ has a unique map preserving non-degeneracy to $D$, which is the map sending a cell to its degeneracy type.
\end{lemma}




We are mostly interested in degeneracy type of cofibrant simplicial set, those can easily be identified:

\begin{lemma}
A degeneracy $n$-type $s \subset Faces(\Delta[n])$ appears as the degeneracy type of a cell in a cofibrant simplicial set if and only if it is decidable (complemented) as a subset of the set of face. Decidable degeneracy type form a sub-simplicial set of $D$ which is cofibrant.
\end{lemma}

\begin{proof}
If $x$ is an $n$-cell of cofibrant simplicial set $X$, then the degeneracy type of $x$ is decidable as for each face $\delta:[i] \rightarrow [n]$ it is decidable if $\delta^* x $ is degenerated or not.
Conversely, if $X$ is any simplicial set and $x \in X$ is an $n$-cell whose degeneracy type is decidable, then the image of the map $\Delta[n] \overset{x}{\rightarrow} X$ is a cofibrant sub-simplicial set of $x$. Indeed it only contains cells of the form $f^*x$ for $f:[k] \rightarrow [n]$. For each such cell, either $f$ is injective in which can it is decidable whether $f^*x$ is degenerated or not by assumption, or $f$ is not injective in which case $f^*x$ is always degenerated. And the degeneracy type of $x$ is the same whether one see as a cell of $X$ or as a cell of this cofibrant subobject.
One immediately see that the subset of $D_0$ of decidable subset is stable under the functoriality of $D_0$ hence form decidable degeneracy types form a simplicial subobject of $D$. This sub-simplicial set has decidable equality and decidable degeneracies.
\end{proof}

\begin{lemma}

Given a map $\partial \Delta[n] \rightarrow D$ there is a unique way to extend it into map $\Delta[n] \rightarrow D$ such that the non-degenerate $n$-cell of $\Delta[n]$ is send to a non-degenerate cell.
\end{lemma}

\begin{proof}
If such an extension exists the $n$-cell $x$ corresponding to $\Delta[n] \rightarrow D$ has to be as follows: $x$ does not contains the face $[n] \rightarrow [n]$, and for all other face $\delta:[i] \rightarrow [n]$ it is in $x$ is and only the composite $[i] \rightarrow \partial \Delta[n] \rightarrow D$ is a degenerate cell. So the uniqueness is clear. We only need to show that this set is indeed a degeneracy type. But if one form $D \coprod_{\partial \Delta[n]} \Delta[n]$ then the new added $n$-cell has exactly this degeneracy type so this conclude the proof.
\end{proof}

Let $X_c \overset{\sim}{\twoheadrightarrow} X $ be the cofibrant replacement of a simplicial set $X$ constructed using Richard Garner version of the small object argument from \cite{garner:small-object-argument}.

\begin{proposition}
The map from $X_c \rightarrow D \times X$ sending an $n$-cell to its degeneracy type $s \in D$ and its image is $X$ induce a bijection between $X_c([n])$ and the set of pairs of a decidable degeneracy type $s$ and a cell of $x$ of degeneracy type larger than $s$.
\end{proposition}

\begin{proof}

Due to the ``stratified'' nature of the simplicial generating cofibration, $X_c$ can be written as the colimit of a sequence:


 \[ X^{(0)}_c \hookrightarrow X^{(1)}_c \hookrightarrow \dots \hookrightarrow X^{(n)}_c \hookrightarrow \dots \]

where $X^{(0)}_c$ is just the set of $0$-cell of $X$ and $X^{(n)}_c$ can be constructed from $X^{(n-1)}$ by taking a multiple pushout $\Delta[n] \coprod_{\partial \Delta[n]} X^{(n-1)}_c$ for each square of the form:

\[ \xymatrix{\partial \Delta[n]  \ar[r] \ar@{^{(}->}[d] & X^{(n-1)}_c \ar[d] \\ \Delta[n]  \ar[r] & X} \]

Indeed, the pushout of $\partial \Delta[n] \hookrightarrow \Delta[n]$ does not change the $k$-skeleton of $X$ for $k <n$ and the set of maps $\partial \Delta[k] \rightarrow X$ only depends on the $k$-skeleton of $X$, so one can always do all the necessary pushout by $\partial \Delta[k] \hookrightarrow \Delta[k]$ by for $k<n$ before those by $\partial \Delta[n] \hookrightarrow \Delta[n]$.


We will prove by induction on $n$ that $X^{(n)}_c$ identifies with $n$-skeleton of the simplicial set mentioned in the proposition, i.e. the sub-simplicial set $Y^n$ of $D \times X$ of pairs $(s,x)$ such $s$ is decidable,  the degeneracy type of $x$ is at least $s$ and $(s,x)$ is of dimension at most $n$, or a degeneracy of a cell of dimension at most $n$.

Note that as the degeneracy type of $x$ is larger than $s$, $s$ is the degeneracy type of the pair $(s,x)$, so the condition on $(s,x)$ being a degeneracy is equivalent to the same condition on $s$.

In the case $n=0$, there is only one degeneracy type in dimension $0$, so both $X^{(0)}_c$ and $Y^0$ are the simplicial set of cells of $X$ that are degeneracy of $0$-cells.

Assuming $Y^{n-1}$ and $X^{(n-1)}_c$ are isomorphic as claimed. One only need to check that the new non-degenerate $n$-cell that appears in $Y^{n}$ and $X^{(n)}_c$ are in bijection compatible to their boundary and their image in $X$.
In $X^{(n)}_s$ there is exactly one such cell for each square as above. In $Y^{n}$, any non-degenerate $n$-cells does produce such a square, and conversely given a square:

\[ \xymatrix{\partial \Delta[n]  \ar[r] \ar@{^{(}->}[d] & Y^{n-1} \ar[d] \\ \Delta[n]  \ar[r] & X} \]

Then the lemma above give a unique map to extend $\partial \Delta[n] \rightarrow D$ to a non-degenerate $n$-cell of $D$, and the image of $\Delta[n]$ in $X$ automatically have a larger degeneracy type that this extension so this gives a non-degenerate cell of $Y^{n}$ generating this square. This is unique way to get such a cell to be non-degenerate as a cell in $Y^n$ is non-degenerate if and only if its image in $D$ is non-degenerate.

\end{proof}


This proposition has some interesting corollaries:

\begin{itemize}

\item $1_c$ is exactly the sub-simplicial set of $D$ of decidable degeneracy type.

\item Even if $X$ is a large simplicial set, its cofibrant replacement $X_c \rightarrow X$ has fiber controlled in size: indeed the fiber over an $n$-cell $x \in X$ is the set of decidable degeneracy $n$-type smaller than the degeneracy type of $x$. In particular it is a subset of the finite set of decidable degeneracy $n$-type. Not that in order to conclude in general that the fiber are small on need some sort of propositional resizing axiom saying that a subclass of a finite set is a small set.

\end{itemize}

\newpage

\section{Dependent products of fibrations}

This section is devoted to proving a counterpart of the classical result that, for a fibration $p \co A \rightarrow X$, the dependent product, or pushforward, functor $\Pi_p \co \SSet_{/A} \to \SSet_{/X}$ preserves fibrations. 

\medskip

We shall concentrate on the classes of fibrations $\Fib$ and of trivial cofibrations $\mathsf{TrivCof}$. 
Recall that the latter is defined to be the class of maps with the left lifting property
with respect to fibrations with fibrant codomain. Furthermore, by the general theory of weak model
structures, we know that a map with cofibrant domain is a trivial cofibration if and only if it is a cofibration
and weak equivalence~\cite[Proposition~2.2.9]{henry2018wms}.  

\medskip

Let $p \co A \rightarrow X$ be a fibration. Observe that $\Pi_p \co \SSet_{/A} \to \SSet_{/X}$  preserves fibrations if and only if its left adjoint, the pullback functor
\[
p^* \co \SSet_{/X} \to \SSet_{/A} \, , 
\]
preserves trivial cofibrations. We now assume  $A$ is cofibrant. 
As the left adjoint is already known to preserve cofibrations by \cref{thm:cof-pbk}, what we need is essentially a form of right properness. We achieve this by following closely \cite[Section~3]{gambino2017frobenius}. Note that we cannot apply directly the result therein since 
the assumption that every object is cofibrant does not hold in our setting. However, only minor modifications are sufficient.


% \begin{lemma} \label{thm:missing-1}
% \hfill 
% \begin{enumerate}[(i)] 
% \item $\mathcal{J} \subset \Cof \cap \mathcal{S}$.
% \item $\Cof \cap \mathcal{S} \subseteq \TrivCof$.
% \end{enumerate}
% \end{lemma} 


\begin{definition} \label{def:strhtpyequiv} Let $k \in \braces{0 \, , 1 }$.
A map $f \co Y \rightarrow X$ in $\SSet$ is a \myemph{strong $k$-oriented homotopy equivalence} if there are maps $H$ and $H_X$ which exhibit $f$ as a retract of $\delta^k \times ' f$ as follows:

\[
\xymatrix@C=2cm{
Y \ar[d]_{f} \ar[r]^-{\delta^{1-k} \times Y} & 
( \Delta[1] \times Y ) \cup X \ar[d]^{\delta^k \times' f} \ar[r]^-{H_X} & 
Y \ar[d]^{f} \\
X \ar[r]_-{\delta^{1-k} \times X}  & 
\Delta[1] \times X \ar[r]_{H} &
X  }
\]
\end{definition}

This definition is equivalent to the one given in \cite{gambino2017frobenius} by Lemma~3.3 therein.
With this definition, it is immediate to observe that a cofibration which is a strong $k$-oriented homotopy equivalence is a trivial cofibration. Indeed, if $f \co Y \to X$ is a cofibration then $\delta^k \times ' f$ is a trivial
cofibration and so $f$ is, since it is a retract of $\delta^k \times ' f$ and hence inherits from it the
required left lifting property.

\begin{lemma}\label{lemma:genTcof_strongHequiv} \hfill 
\begin{enumerate}[$(i)$]
\item For $i < n$, the horn inclusions $h^n_i \co \Lambda^i[n] \hookrightarrow \Delta[n]$ are strong $0$-oriented homotopy equivalences,
\item For $0 < i $, the horn inclusions $h^n_i \co \Lambda^i[n] \hookrightarrow \Delta[n]$ are strong $1$-oriented homotopy equivalences.
\end{enumerate}
\end{lemma}

\begin{proof}
This is shown as part of~\cite[Theorem 3.2.3]{joyal-tierney:simplicial-homotopy-theory}. The proof given there can be easily checked to be constructive. This argument as also been reproduced (in the context of complicial sets) in the first part of the proof of \cite[Proposition~5.2.6]{henry2018wms} which is developed in constructive settings.
\end{proof}

%I've only added the reference to my paper to avoid having Joyal and Tierney's notes as unique reference for this. But If you think it is fine, you can remove it.



\begin{lemma} 
\label{lemma:pb_of_StrongHomotopyEq}
Let $p \co A \rightarrow X$ be a fibration with cofibrant domain. Then, for $k \in \{0,1\}$, 
the pullback functor $p^* \co \SSet_{/X} \to \SSet_{/A}$ preserves strong $k$-oriented homotopy equivalences.
\end{lemma}



\begin{proof} This is essentially \cite[Lemma~3.7]{gambino2017frobenius}, but we provide some details
for the convenience of the reader.
Let $f \co Y \rightarrow X$ be a strong $k$-oriented homotopy equivalence. Let $H$ and $H_X$  maps 
as in~\cref{def:strhtpyequiv}. Let $p \co A \rightarrow X$ be a fibration and consider the pullback
\[
\xymatrix@C=1.5cm{
A[f] \ar[r]^-{p^*(f)}  \ar[d]_{p_{A[f]}} & A \ar[d]^{p} \\
Y \ar[r]_{f} & X \\
}
\] 
To show that $p^*(f)$ is a strong $k$-oriented homotopy equivalence, we let $K \co \Delta[1] \times A \rightarrow A$ be a diagonal filler in the square:
\[
\xymatrix@C=1.5cm{
A \ar[d]_{\delta^{1-k}} \ar@{=}[rr] & & A \ar[d]^p \\ 
\Delta[1] \times A \ar[r]_{\Delta[1] \times p}  & \Delta[1] \times X \ar[r]_H & X
}\]
Where the map on the left-hand side is a trivial cofibration because $A$ is a cofibrant.
It remains to construct a map $K_Y$  fitting into a retract diagram of the form
\[
\xymatrix@C=1.5cm{
A[f]  \ar[d]_{p^*(f)} \ar[r] &  (\Delta[1] \times A[f])  \cup Y \ar[d]^{\delta^k \times' p^*(f)} \ar[r]^-{K_Y} & A[f] \ar[d]^{p^*(f)} \\
A \ar[r] & \Delta[1]  \times A \ar[r]_-{K} & A
}
\]
We define it using the universal property of $A[f]$ as the unique map to $A[f]$ such that the image in $X$ is the one specified by the diagram above, and the value in $Y$ is the one given by $H_X$ composed with the map $(\Delta[1] \times A[f]) \cup Y$ to $(\Delta[1] \times A[f]) \cup X$. These indeed have the same image in $X$ exactly because of the commutation of lower triangle in the filler diagram defining~$H'$. The commutation of the diagram and the fact that the upper line is a retract are immediate with this definition.
\end{proof}



\begin{proposition}\label{prop:Frobenius}
Let $p \co A \rightarrow X$ is a fibration with cofibrant domain. Then the pullback functor 
\[
p^* : \SSet_{/A} \rightarrow \SSet_{/X}
\] 
preserves cofibrations and trivial cofibrations.
\end{proposition}


\begin{proof} Since the pullback functor $p^*$ has a right adjoint,  it is enough to check that pullbacks of generating trivial cofibrations and generating cofibrations are trivial cofibrations and cofibrations, respectively. For cofibrations, this is \cref{thm:cof-pbk}. For trivial cofibrations, the generating trivial cofibrations of $\SSet_{/Y}$ are the horn inclusions $h^k_n \co \Lambda^{k}[n] \hookrightarrow \Delta[n]$ for all possible choices of $\Delta[n] \rightarrow A$. By \cref{lemma:genTcof_strongHequiv} they are all strong $k$-oriented homotopy equivalences. Moreover, their pullback to $X$ is also their pullback along the map $A \times_X \Delta[n] \rightarrow \Delta[n]$ which is again a fibration with cofibrant domain by \cref{lem:cofibrant_fiber_product}. Hence  \cref{lemma:pb_of_StrongHomotopyEq} implies that the pullback 
to~$X$ are also strong $k$-oriented homotopy equivalences. Since they are cofibrations, they are trivial cofibrations.
\end{proof}

\begin{corollary}\label{cor:Pi_types_are_fibrant}
Let $p \co A \rightarrow X$ be a fibration with cofibrant domain and $q \co B \rightarrow A$ a fibration. Then $\Pi_p(q) \co \Pi_A(B) \rightarrow X$ is a fibration.
\end{corollary}

\begin{proof}
Since $p^*$ preserves cofibrations and trivial cofibrations. its right adjoint $p_*$ preserves fibrations and trivial fibrations. In particular, it preserves fibrant objects.
\end{proof}


Let us illustrate the role played by the cofibrancy assumpion in~\cref{cor:Pi_types_are_fibrant} by discussing
a special case of it. Recall that, classically,  if $A$ and $B$ are simplicial
sets and $B$ is a Kan complex, then the exponential $B^A$ is a Kan complex. While this result is
not provable without the law of excluded middle, constructively our results imply that if $A$ and $B$ are simplicial sets, $A$ is cofibrant and $B$ is a Kan complex, then $B^A$ is a Kan complex. For this, it is sufficient to apply \cref{cor:Pi_types_are_fibrant}
with $p \co A \to 1$ the unique map into the terminal object and $q \co B \times A \to A$ the second projection, which is a fibration if $B$ is a Kan complex. Of course, this fact can also be established directly, by inspecting the classical proofs, exploiting the decidability of degeracy instead of appealing to the law of excluded middle.
It should be noted that, in general, $B^A$ is no longer cofibrant. This creates some issues for modelling type
theory, which we discuss in~\cref{sec:conout}.


% \begin{theorem} 
% \label{thm:restricted-frobenius}
% The semi-model structure for Kan complexes on $\SSet$ has the restricted Frobenius condition.
% \end{theorem} 

% \begin{proof}  Since the semi-model structure in which we 
% are working is cofibrantly generated, it is sufficient [TO CHECK] that $p^*$ sends generating trivial cofibrations to trivial cofibrations. So, let $p \co B \to \Delta[n]$ be a fibration, $i \co \Lambda^k[n]
% \to \Delta[n]$ be a horn inclusion, and define $ j \defeq p^*(i)$, given by 
% the pullback diagram
% \[
% \xymatrix{
% \bullet  \ar[r] \ar[d]_j \drpullback & \Lambda^k[n] \ar[d]^{i} \\
% B \ar[r]_-{p} & \Delta[n] }
% \]
% We need to show that $j$ is a trivial cofibration.  
% First, since $i$ is a trivial cofibration, it is in particular
% a cofibration and therefore $j$ is again a cofibration by~\cref{thm:cof-pbk}. Secondly, since~$i \in \cal{J}$,
% by part~(i) of \cref{thm:missing-1}, it is a cofibration and a strong homotopy equivalence. Since its codomain is cofibrant, $j$ is a strong homotopy equivalence by~\cref{thm:missing-2}.
% But now $j$ is both a cofibration and a strong homotopy equivalence
% and hence it is a trivial cofibration, as required, by part~(ii) of \cref{thm:missing-2}.
% \end{proof} 



\newpage

\section{The universe}

Our next goal is to define a bifibrant simplicial set $\U_c$ and a small fibration $\pi_c \co \UU_c \to \U_c$ that weakly classifies small fibrations between cofibrant objects, in the sense that for every such fibration $p \co A \to X$ there exists a map $a \co X \to \U_c$ such that $p$ is a pullback of $\pi_c$ along $a$, \ie we have a pullback diagram of the form
\[
\xymatrix{
A \ar[r] \ar[d]_p   & \UU_c \ar[d]^{\pi_c} \\
X \ar[r]_a &  \U_c }
\]
We shall refer to $\U_c$ as the universe of small fibrant simplicial sets and to $\pi_c$ as the 
weakly universal small fibration between cofibrant simplicial sets.
In order to do this, we shall modify  the construction of the weak classifier for small fibrations 
in~\cite{voevodsky-simplicial-model} and then consider a suitable cofibrant replacement. 

\medskip

We begin by reviewing the definition of the weakly universal small map of simplicial sets, which
can be obtained as a special case of the results in~\cite{hofmann-streicher-universes} for arbitrary presheaf
categories. Recall that, again as a special case of a general result for presheaf categories, for every $[n] \in \Delta$, there is an equivalence of categories
\begin{equation}
\label{equ:pshslice}
\SSet_{/\Delta[n]} \simeq \Psh \big( \Delta_{/[n]} \big )
\end{equation}
For $F \co {\Delta_{/[n]}}^{\op} \to \Set$, we write $\pi_1 \co \mathrm{el}(F) \to \Delta[n]$
for the corresponding object of~$\SSet_{/\Delta[n]}$. The simplicial set $\V$ is then defined by letting
\[
\mathsf{V}_n \defeq \{ F \in \Psh(\Delta_{/[n]}) \ | \ \pi_1 \co \mathsf{el}(F) \to \Delta[n] \text{ is a small
map} \}
\]
for $[n] \in \Delta$. The weakly universal small map $\rho \co \VV \to \V$ is then defined in an evident way. 

\medskip

We define a subobject $\U \rightarrowtail \V$ by letting, for $[n] \in \Delta$, 
\[
\U_n = \{ F \in \V_n \ | \ \pi_1 \co \mathsf{el}(F) \to \Delta[n] \text{ is a small Kan fibration and $\mathsf{el}(F)$ is cofibrant} \} \, .
\]
We then define the map $\pi \co \UU \to \U$ via the pullback 
\[
\xymatrix{
\UU \ar[r] \ar[d]_\pi \drpullback  & \VV \ar[d]^\rho \\
\U \ar@{>->}[r] & \V }
\]




\begin{proposition} \label{thm:universe-u}  \hfill 
\begin{enumerate}[(i)] 
\item The map $\pi \co \UU \to \U$ is a small fibration.
\item For any map $a \co X \rightarrow \U$ with $X$ cofibrant, the 
simplicial set $X.\mathsf{T}(a)$ given by the pullback
\[
\xymatrix{
X.\mathsf{T}(a) \ar[r] \ar[d]_p & \UU \ar[d]^\pi \\
X \ar[r]_a & \U }
\]
is cofibrant.
\item The map $\pi \co \UU \to \U$ weakly classifies small fibrations between cofibrant object, \ie 
for every small fibration $p \co A \to X$ between cofibrant object there exists a map 
$a \co X \to \U$ and a pullback  of the form
\[
\xymatrix{
A \ar[r] \ar[d]_p \drpullback & \UU \ar[d]^\pi \\
X \ar[r]_{a} & \U }
\]
\end{enumerate}
\end{proposition}

\begin{proof} We prove the three claims separately.
\begin{enumerate}[(i)] 
\item For any map $a \co \Delta[n] \rightarrow \U$, we can consider the following pullbacks
\[
\xymatrix{
E \ar[r] \ar[d]_p  & \UU \ar[d] \ar[r]  & \VV \ar[d] \\
\Delta[n] \ar[r]_{a} & \U \ar[r]_{i} & \V }
\]
This shows that $p \co E \rightarrow \Delta[n]$ is isomorphic to $\pi_1 \co \mathrm{el}(F) \rightarrow \Delta[n]$ in $\SSet_{/ \Delta[n]}$, where $F$ corresponds under the equivalence in~\eqref{equ:pshslice} to 
$i a \co \Delta[n] \rightarrow \V$, hence by definition of $\U$, $E$ is cofibrant and $p \co E \rightarrow \Delta[n]$ is a small fibration. This implies that $\pi:\UU \rightarrow \U$ is a small map. Furthermore, $\pi$ is a fibration
since we can rewrite a general lifting problem against a horn inclusion $h^n_k \co \Lambda^k[n] \rightarrow \Delta[n]$ as follows:
\[
\xymatrix{
\Lambda^k[n] \ar[r] \ar[d]_{h^k_n} & \Delta[n]. \mathsf{T}(a)  \ar[d]^{p} \ar[r] & \UU \ar[d]^\pi \\
\Delta[n] \ar@{=}[r]  & \Delta[n] \ar[r]_a & \U  }
\]
and then use that $p \co \Delta[n]. \mathsf{T}(a)  \to \Delta[n]$ is a fibration.
\item  Let $[n] \in \Delta$, $y \in Y_n$ and define $x \defeq p(y)$. Since $X$ is cofibrant, by \cref{lem:EZ_cof} can write it in a unique way as $x=s^*(x')$, where $s \co [n] \twoheadrightarrow [k]$ is a degeneracy and 
$x' \in X_k$ is a non-degenerate cell. Let $x' \co \Delta[k] \rightarrow X$ be the corresponding map. We now form the pullback
\[
\xymatrix{
E \ar[r]^w \ar[d] \drpullback & Y \ar[r] \ar[d]_{p} \drpullback & \UU \ar[d]^\pi \\
\Delta[k] \ar[r]_{x'} & X \ar[r] & \U }
\]
By the universal property of the pullback, there is a unique cell $e \in E_n$ such that $w(e)=y$, and the image of $e$ in $\Delta[k]$ is the cell $s \co [n] \twoheadrightarrow [k]$, whose image in $X$ are both equal to $x=s^* x'$.

By definition of $\U$, the simplicial set $E$ is cofibrant and hence it is decidable whether $e$ is degenerate or not. We claim that $y$ is degenerate if and only if $e$ is, which implies that it is decidable whether $y$ is degenerate:

Indeed as $y = w(e)$ then if $e$ is degenerate so $y$ is. Conversely, assume that $y=p^*(y_1)$ for a non-trivial degeneracy $p$. Then $x=p^*(x_1)$, hence by the uniqueness part of the Eilenberg-Zilber lemma for $X$ one has that $s=q \circ p$ for some degeneracy $q$, and $x_1 = q^*(x')$. In particular, we get a unique cell $e_1$ of $E$ whose image in $\Delta[n]$ and $Y$ are  $q$ and $y_1$, respectively, whose images in $X$ are both equal to $x_1=q^*(x')$. Finally, the image of $p^*(e_1)$ in $\Delta[n]$ and~$Y$ are  $p^* y_1 =y$ and $q \circ p =s$, respectively, and hence $p^*(e_1) =e$, which proves that $e$ is degenerate as soon as $y$ is.



\item Any small map $Y \rightarrow X$ is a pullback of $\rho \co \VV \rightarrow \V$. The corresponding map $X \rightarrow \V$ factors in $U \subset V$ if and only if for every $\Delta[n] \rightarrow X$ the pullback of $Y$, $E \rightarrow \Delta[n]$ is a small fibration with $E$ cofibrant. So if $Y$ is cofibrant then $E$ is cofibrant because of~\cref{lem:cofibrant_fiber_product} and if $Y \rightarrow X$ is a small fibration then any of its pullback is also a small fibration.  \qedhere
\end{enumerate}
\end{proof} 



The simplicial set $\U$ and $\UU$ does not appear to be cofibrant, but we can consider a cofibrant replacement of $\U$, given by a cofibrant object $\U_c$ and a trivial cofibration
\begin{equation}
\label{equ:ucu}
p \co \U_c \rightarrow \U
\end{equation}
We then define $\UU_c$ via the pullback
\[
\xymatrix{
\UU_c \ar[d]_{\pi_c} \ar[r] \drpullback & \UU \ar[d]^{\pi}  \\
\U_c \ar[r]_p & \U}
\]
We now prove that $\U_c$ and $\pi_c \co \UU_c \to \U_c$ have the desired properties.


\begin{proposition} \label{thm:universe-uc} 
\hfill 
\begin{enumerate}[(i)] 
\item $\pi_c \co \UU_c \to \U_c$ is a small fibration between fibrant objects. 
\item The map $\pi_c \co \UU_c \to \U_c$ classifies small fibrations between cofibrant objects, \ie 
for every small fibration $p \co A \to X$ with $X$ and $A$ cofibrant there exists a pullback diagram of the form
\[
\xymatrix{
A \ar[r] \ar[d]_p & \UU_c \ar[d]^{\pi_c} \\
X \ar[r]_a & \U_c }
\]
\item The object $\UU_c$ is cofibrant. \noten{Not sure we need this}
\end{enumerate}
\end{proposition}

\begin{proof} \hfill
\begin{enumerate}[(i)] 
\item The claim follows from parts~(i) and~(ii) of~\cref{thm:universe-u}. 
\item Let $p \co A \to X$ be a small fibration with $X$ cofibrant. Since $p$ is a
small fibration, we know 
from part~(iii) of \cref{thm:universe-u} that there is a pullback diagram of the form 
\[
\xymatrix{
A \ar[r] \ar[d]_p \drpullback & \UU \ar[d]^{\pi} \\
X \ar[r] & \U }
\]
Since $X$ is cofibrant, we have the lifting diagram
\[
\xymatrix{
0 \ar[r] \ar[d] & \U_c \ar[d]^{} \\
X \ar[r]_a \ar@{.>}[ur] & \U }
\]
which shows that the map $a \co X \to \U$ factors via $\U_c$.  We then obtain the diagram
\[
\xymatrix{
A \ar[r] \ar[d]_p &  \UU_c \ar[r]  \ar[d]^{\pi_c} \drpullback & \UU \ar[d]^{\pi} \\
X \ar[r]_{a_c} & \U_c \ar[r]_{a} &  \U }
\]
Here, the right-hand side square and the rectangle are pullbacks and therefore the left-hand
side square is also a pullback, as required. 
\item The claim follows from the fact that both $\U_c$ and
$\UU$ are cofibrant, the latter holding by part (iii) of~\cref{thm:universe-u}, via \cref{lem:cofibrant_fiber_product}. \qedhere
\end{enumerate} 
\end{proof} 





Note that we have not shown yet that the simplicial set $\U_c$ fibrant. This will be done in~\cref{sec:fibuu}, as a consequence of the equivalence extension property for fibrations, which we establish in~\cref{sec:equep}.

\newpage


\section{The weak equivalence extension property}
\label{sec:equep}

The main goal of this section is to prove the so-called weak equivalence extension property, which will be the key to prove that the universe $\UU_c$ is fibrant and that the weakly universal fibration $\pi \co \UU_c \to $ is univalent.  For this, we follow closely the approach in \cite{voevodsky-simplicial-model}, but exploiting crucially the cofibrancy requirements that are part of our set-up.



\begin{lemma}\label{Lemma:ForTheExtProperty} Let $f \co Y \rightarrow X$ be a cofibration with $Y$ cofibrant. 
\begin{enumerate}[$(i)$]
\item The functor $\Pi_f \co \SSet_{/Y} \rightarrow \SSet_{/X}$ preserves trivial fibrations.
\item The counit of the adjunction $f^* \dashv \Pi_f$ is a natural isomorphism.
\item If $g \co \Xi \to Y$  is cofibrant in $\SSet_{/Y}$, then $\Pi_f(g) \co \Pi_f(\Xi) \to X$  is cofibrant in~$\SSet_{/X}$.
\item Trivial fibrations extend along cofibrations with cofibrant domain, \ie given a trivial fibration $q
 \co B \to Y$  as in the solid diagram:
\[
\xymatrix{
B \ar@{.>}[r] \ar[d]_{q} \drpullback  & A \ar@{.>}[d]^{p} \\
Y \ar[r]_f &  X \, ,}
\]
then there exists a trivial fibration $p \co A \rightarrow X$ which fits in the dotted pullback square above. Moreover if $B$ is cofibrant  then 
$A$ can be assumed to be 
cofibrant as well.
\end{enumerate}
\end{lemma}

 
\begin{proof} We prove the different parts separately. 
\begin{enumerate}[$(i)$] 
\item 

Since the functor $\Pi_f$ is the right adjoint to the pullback functor $f^*$ and trivial fibrations are the maps with the the right lifting property with respect to cofibrations between cofibrant objects, $\Pi_f$ preserves trivial fibrations if and only if $f^*$ preserve cofibration between cofibrant objects. But this follows by~\cref{thm:cof-pbk}.

\item As $f$ is a monomorphism, then the forgetful functor $\Sigma_{f} \co \SSet_{/X} \rightarrow \SSet_{/Y}$ is fully faithful and hence the unit $\eta \co 1_{\SSet_{/A}} \rightarrow f^* \Sigma_{f}$ is an isomorphism. By adjointness, the counit $\varepsilon \co 1_{\SSet_{/Y}} \rightarrow f^* \Pi_f$ is also an isomorphism.

\item Let $v$ be a $n$-cell in $\Pi_i(X)$.
If the image of $v$ is in $A$ then $v$ is a cell of $X \subset \Pi_i(X)$, in which case it is decidable whether $v$ is degenerate or not.
As $A$ is levelwise complemented in $B$, one can assume that $v$ is not in the image of $A$. In this case it is decidable if the image of $v$ in $B$ is degenerate or not.
Infact, by the Eilenberg-Zilber lemma one can also decide for each given degeneracy if the image of $v$ is degenerate for this precise degeneracy or not. 

Let $\sigma \co [n] \twoheadrightarrow [k]$ be any degeneracy, we will show that it is decidable whether $v$ is ``$\sigma$-degenerate, i.e. if $v =\sigma^* v'$ for some $v'$. Note that if $v$ is $\sigma$-degenerate then its image in $B$ is as well. As this is a decidable question, one can freely assume that the image of $v$ in $B$ is $\sigma$-degenerate, i.e. for the form $\sigma^* b$ for some $b \in B$ (and not in $A$).

 One can form the pullback square:


\[
\xymatrix{
V \ar@{^{(}->}[r] \drpullback \ar[d] & \Delta[n] \ar@{->}[d]^{\sigma} \\
V_{\sigma} \ar@{^{(}->}[r] \drpullback \ar[d] & \Delta[k] \ar@{->}[d]^b \\
A \ar@{^{(}->}[r] &  B }
\]

Given its image in $B$, the cell $v: \Delta[n] \rightarrow \Pi_i X$ is uniquely determined by the data of a morphism $\lambda: V\rightarrow X$. The cell $v$ is $\sigma$-degenerate if and only if $\lambda$ factors in $V_{\sigma}$ (such a factorization being unique if it exists). For any $J \subset [n]$, the $J$-face of a cell is said to be $\sigma$-degenerate if and only if it is degenerate for the (potentially trivial) degeneracy: $\sigma_{|J} : J \rightarrow \sigma(J)$. We claim that $\lambda$ factor into $V_{\sigma}$ if and only for all $i:[f] \hookrightarrow [n]$ that belong to $V$ (and $V$ is decidable so there is only a finite cardinal of them), $i^* \lambda$ is $\sigma$-degenerate (which is dediable). Indeed $V$ is the gluing of all the $\sigma \circ i$ for such faces, for each individual face $i$ one has a factorization into its image in $V_{\sigma}$ if and only if $i^* \lambda$ is $\sigma$-degenerate, and as such factorization are unique they patch together on $V_{\sigma}$ is they all exists.

\item One can simply take $p \co A \to X$ to be $\Pi_f(q) \co X.\Pi_f(B) \to X$. Indeed, it is a trivial fibration by part~$(i)$ and the square is a pullback by part $(ii)$. The final remark about the cofibrancy of 
$A$ follows from $(iii)$. \qedhere
\end{enumerate}
\end{proof}


\notesh{I remember we proved $(iii)$ explicitly as this was something I was worried about. But the proof above is a lot harder than in my memories. Do you have any notes about this claims ? If not just erase this note.}



\begin{proposition}[Weak equivalence extension property]
\label{Prop:Homotopy_ext_prop}
Let $p \co A \to X$ and $q \co B \to Y$ be fibrations and let
\[
\xymatrix{
B \ar[r] \ar[d]_q & A \ar[d]^p \\
Y \ar[r]_f & X}
\]
be a commutative diagram with $f \co Y \to X$ a cofibration and such that the canonical map
\begin{equation}
\label{equ:gluedata}
\begin{gathered}
\xymatrix{
B \ar[rr]^{u} \ar[dr] &  & A[f] \ar[dl] \\
 & Y &}
 \end{gathered}
 \end{equation}
is a weak equivalence in $\SSet_{/ Y}$. Then there exists a fibration $\bar{q} \co \bar{B} \to X$ and a weak equivalence
\[
\xymatrix{
\bar{B} \ar[rr]^{v} \ar[dr]_{\bar{q}} &  & A \ar[dl]^{p} \\
 & X &}
 \]
 in $\SSet_{/X}$ such that all the squares in the diagram
\[ 
\xymatrix{
 B
  \ar@{.>}[rr]
  \ar[dr]^{u}
  \ar[dd]_(.3){q}
&&
  \bar{B}
  \ar@{.>}[dr]^{v}
  \ar@{.>}[dd]_(.3){\bar{q}}|{\hole}
&\\&
  A[f] 
  \ar[rr]
  \ar[dl]
&&
  A
  \ar[dl]^{p}
\\
  Y
  \ar[rr]_{f}
&&
  X
&
}
\]
are pullbacks. 
\end{proposition}

\begin{proof} We define the required object $\bar{B}$ as the following pullback:
\[\xymatrix{
\bar{B} \ar[d] \ar[r] \drpullback & \Pi_f(B) \ar[d] \\
A \ar[r]_-{\eta_{A}} & \Pi_f \big( A[f]  \big) \, ,
}\]
where $\eta_{A}$ is  a component of the unit of adjunction  $f^* \dashv \Pi_f$. An application of the pullback functor $f^* \co \SSet_{/X} \to \SSet_{/Y}$ to this pullback square gives the commutative square
\[\xymatrix{
\bar{B}[f] \ar[d] \ar[r]  & B \ar[d] \\
A[f] \ar@{=}[r] &A[f] 
}\]
This is a pullback since $f^* \Pi_f \iso 1$ by part~(ii) \cref{Lemma:ForTheExtProperty}. Hence 
$B \iso \bar{B}[f]$, as required.


Since $B$ is cofibrant, we have that $X.\Pi_f(B)$ is cofibrant by part~(iii) of  \cref{Lemma:ForTheExtProperty}. Hence, the simplicial set~$\bar{B}$  is also cofibrant by \cref{lem:cofibrant_fiber_product}. Furthermore, the maps $B \rightarrow \bar{B}$ and~$A[f] \rightarrow A$ are cofibrations by~\cref{thm:cof-pbk}, as they are pullback of the cofibration~$f \co Y \rightarrow X$.





It remains to prove that $v \co \bar{B} \rightarrow A$ is a weak equivalence and that 
$\bar{q} \co \bar{B} \rightarrow X$ is a fibration. Since, by \cref{lemma:triv_fib_are_we}, the map $u$ can be factored into a trivial cofibration followed by a trivial fibration, and our construction are functorial, it is sufficient to prove these claims when~$u$ is a trivial fibration or a trivial cofibration.

If $u$ is a trivial fibration, then its image under $f_*$ is a trivial fibration by 
part~(i) of \cref{Lemma:ForTheExtProperty}. Since the map $\bar{B} \rightarrow A$ is a pullback of this map,
it is also a trivial fibration. This also implies that the composite $\bar{B} \rightarrow A \rightarrow X$ is a fibration.


We now assume that $u \co B \rightarrow A[f]$ is a trivial cofibration. Using that the maps from $\bar{B}$ and $A[f]$ to $Y$ are fibrations, we can show that $u$ is a strong deformation retract over $Y$, \ie there is a retraction $r \co A[f] \rightarrow B$ of $u$ in $\SSet_{/Y}$ and a homotopy 
\[
H \co \Delta[1] \times A[f] \rightarrow A[f]
\] 
between 
$u \circ r$ and $1_{A[f]}$, whose composite with $A[f] \rightarrow Y$ is the trivial homotopy.

We want to show that $\bar{B} \rightarrow A$ is also a deformation retract by constructing a similar homotopy 
\[
H' \co \Delta[1] \times A \rightarrow A \, .
\] 
This homotopy will be constructed so that it is $H$ on $I \times A[f]$ ,  it is the map 
\[
\Delta[1] \times \bar{B} \rightarrow \Delta[0]  \times \bar{B} \iso \bar{B} \rightarrow A
\] 
on $\Delta[0] \times \bar{B} $ (indeed they agree on $\Delta[1] \times B$) and it is the identity on $\Delta[0] \times A$.  This is achieved by taking a diagonal filling in the square:
\[
\xymatrix@C=1.5cm{
\big( \Delta[1] \times (\bar{B} \cup A[f]) \big)  \cup \big( \Delta[0] \times A \big) \ar[d] \ar[r] & A \ar[d] \\
\Delta[1] \times A \ar[r] \ar@{.>}[ur]^{H'} & X
}\]
Such a diagonall filler exists since the map on the left-hand side is a trivial cofibration, being the 
 pushout-product of $Y_0 \co \Delta[0] \rightarrow \Delta[1]$ and the cofibration $\bar{B} \cup A[f] \rightarrow A$, and the map on the right-hand side is a fibration by assumption.

It remains to see that the map $H_{1} \co A \rightarrow A$ is indeed a retraction of $\bar{B} \rightarrow A$. We already know that the restriction of $H_{1}$ to $\bar{B}$ is  the inclusion of $\bar{B}$ in $A$, so it is enough to show that $H_{1}$ has values in $\bar{B}$. We also know that $H_{1}$ restricted to $A[f]$ takes values in $B \subseteq \bar{B}$. By definition of $\bar{B}$, the map $H_1$ factor into $\bar{B}$ if and only if it takes values in $X.\Pi_f(B)$ when seen as a map to $X.\Pi_f(A[f])$, and by adjunction this is the case if and only if the map corresponding to $H_1$, $A[f]= f^*(A) \rightarrow A[f]$ takes values in $B$, but already mentioned above that this was indeed the case.

The fact that $\bar{B} \rightarrow A$ is a deformation retract show that it is invertible in the homotopy category, in particular it is indeed a weak equivalence. The construction above also shows that~$\bar{B}$ is retract of $A$ in $\SSet_{/X}$ and hence $\bar{q} \co \bar{B} \rightarrow X$ is a fibration because $p \co A \rightarrow X$ is.
\end{proof}

\newpage

\section{Fibrancy and univalence of the universe}
\label{sec:fibuu}


\begin{itemize}
% \item Fibrancy should follow directly from equivalence extension property, without using `composition vs filling' but rather retract property for horns (see notes).
% \item Once we have established fibrancy of $U_c$, then one can prove univalence by showing that 
% $t \co \mathsf{Weq}(U_c) \to U_c$ is a trivial fibration. 
\item Question: do we need to know that $\mathsf{Weq}(\U_c)$ is a cofibrant object to get univalence? >> I'm relatively sure $\mathsf{Weq}(\U_c)$ is not cofibrant. But all these property proved here will imediately pass to any cofibrant replacement. This is also why I'm working with  $\mathsf{Weq}(\U)$ instead: everything will be pulled back to the version for $\U_c$.
\end{itemize}


\begin{definition}
\leavevmode
\begin{itemize}

\item Let $\U^{\rightarrow}$ be the simplicial set whose $n$-cells are given by a pair of $n$-cells of $\U$, i.e. functor $(\Delta/[n])^{op} \rightarrow Set$, together with a natural transformation between them.


\item Let $\mathsf{Weq}(\U)$ be the subobject of $\U^{\rightarrow}$ of $n$-cells $\Delta[n] \rightarrow \U^{\rightarrow}$ such that in the corresponding diagram:
 

\[\xymatrix{ X \ar[r]^{f} \ar@{->>}[dr] & Y \ar@{->>}[d] \\
& \Delta[n]
}\]

The map $f$ is weak equivalence.

\end{itemize}

\end{definition}


The fact that $\mathsf{Weq}(\U)$ is well defined is because pullback along any morphism $f:X \rightarrow Y$ is always a right Quillen functor $\SSet_{/Y} \rightarrow \SSet_{/X}$ so in particular it preserves weak equivalence between fibrant objects, so $\mathsf{Weq}(\U)$ as defined here is indeed a sub-simplicial set of $\U^{\rightarrow}$

\begin{proposition}
\label{prop:Weq_classify_Weq}
For any cofibrant object $X$, a morphism $f:X \rightarrow \U^{\rightarrow}$ factors into the subobject $\mathsf{Weq}(\U)$ if and only the map in $\SSet_{/X}$ classified by $f$ is a weak equivalence.

\end{proposition}

\begin{proof}
By definition of $\mathsf{Weq}(\U)$ such a map $v:X \rightarrow \U^{\rightarrow}$ factor into $\mathsf{Weq}(\U)$ if and only if for any simplex $\Delta[n] \rightarrow X$ the pullback to $\Delta[n]$ of the map classied by $v$ is a weak equivalence. As observed above this is indeed the case if $v$ is a weak equivalence. One needs to check that conversely if for $v$ a map $E_1 \rightarrow E_2$ between two bifibrant objects of $\SSet_{/X}$, if every pullback of $v$ along a map $\Delta[n] \rightarrow X$ is a weak equivalence then $v$ is also equivalence.  For such a $v$ one proves that $v$ is a weak equivalence by testing that it has the weak lifting property against all $\partial \Delta[n] \hookrightarrow \Delta[n]$ (we are using theorem $2.5.6$ of \cite{henry2018wms}, more precisely its reformulation of $2.5.7$) given a diagram:


\[ \xymatrix{\partial \Delta[n] \ar[r] \ar@{^{(}->}[d] & E_1 \ar[d]^v \\
\Delta[n] \ar[r] \ar[dr]^{x}
 & E_2 \ar[d] \\
& X
} \]

But one can then pullback everything to $\Delta[n]$:

\[ \xymatrix{\partial \Delta[n] \ar[r] \ar@{^{(}->}[d] & E_1 \times_X \Delta[n] \ar[d]^{x^*v} \\
\Delta[n] \ar[r] & E_2 \times_X \Delta[n]  \\
} \]

by assumption $x^* v$ is a weak equivalence between fibrant objects hence it has the weak lifting property against $\partial \Delta[n] \rightarrow \Delta[n]$ and a weak lift in the square gives in particular a weak lift in the original square.
\end{proof}



\begin{proposition}
\leavevmode
\begin{enumerate}[(i)]

\item The map $\mathsf{Weq}(\U) \rightarrow \U \times \U$ is a fibration.

\item The target projection $\mathsf{Weq}(\U) \rightarrow \U$ is a trivial fibration.

\item $\U$ and $\mathsf{Weq}(\U)$ are fibrant.

\end{enumerate}

\end{proposition}

\begin{proof}
\leavevmode
\begin{enumerate}[(i)]

\item First, one observe that $\U^{\rightarrow}$ can be defined as a $\Pi$-type: It is exactly $\Pi_p(\UU \times \UU)$ where $p$ is the projection $\UU \times \U \rightarrow \U \times \U$,
so it follows from corollary \ref{cor:Pi_types_are_fibrant} that $\U^{\rightarrow} \rightarrow \U \times \U$ is a fibration.
More precisely, it follows from corollary  \ref{cor:Pi_types_are_fibrant} that any pullback of  $\U^{\rightarrow} \rightarrow \U \times \U$ to a cofibrant
$X \rightarrow \U \times \U$ is a fibration (due to the cofibrancy assumption of corollary \ref{cor:Pi_types_are_fibrant}),
but this is sufficient to prove that $\U^{\rightarrow} \rightarrow \U \times \U$ is a fibration (see for example the argument
in the proof of point $(1)$ of proposition \ref{thm:universe-u}).


Let $j:A \overset{\sim}{\hookrightarrow} B$ be any trivial cofibration between cofibrant objects, and consider a square:

\[ \xymatrix{ A \ar@{^{(}->}[d] \ar[r]^{f} & \mathsf{Weq}(\U) \ar[d] \\
B \ar[r]^{g} & \U^{\rightarrow}
}\]

The right map is a monomorphism, so a lifting if it exists is unique. It exists if the map in $\SSet_{/B}$ classified by $g$ is a weak equivalence. But its pullback to $A$ is a weak equivalence, so:

\[ \xymatrix{ 
j^* E_2 \ar[d]^{\sim} \ar[r] \drpullback & E_2 \ar[d]^{\sim ?} \\
j^* E_1 \ar[r] \ar[d] \drpullback  & E_1 \ar[d] \\
A \ar@{^{(}->}[r]^{\sim} & B \\
}\]

But as the maps $E_i \rightarrow B$ are fibration with cofibrant domain, so proposition \ref{prop:Frobenius} implies that pullbacks of trivial cofibration (between cofibrant objects) along such map are trivial cofibration. This implies that all the horizontal maps of the diagram above are weak equivalence, and to the upper right map also is. This shows that $\mathsf{Weq}(\U) \twoheadrightarrow \U^{\rightarrow} \twoheadrightarrow \U \times \U$ is a fibration.




\item Consider any cofibration $A\hookrightarrow B$ between cofibrant objects, and a lifting problem:

\[\xymatrix{ A \ar[d] \ar[r] & \mathsf{Weq}(\U) \ar[d] \\
B \ar[r] \ar@{.>}[ur]^{\exists ?} & \U 
}\]

Then because of proposition \ref{prop:Weq_classify_Weq} this corresponds exactly to a diagram as in the equivalence extention properpty (see \ref{Prop:Homotopy_ext_prop}): the map $A \rightarrow  \mathsf{Weq}(\U)$ gives us $X_0$ and $X_1$ over $A$ and the weak equivalence between them, and the map $B \rightarrow \U$ gives us the object $Y_1$ over $B$. The commutation of the square shows that $X_1$ is the pullback of $Y_1$, and the completion of this diagram claimed by proposition \ref{Prop:Homotopy_ext_prop} is exactly what one needs to produce a diagonal filling.

\item Given the first two part of the proposition, it is sufficient to show that $\U$ is fibrant.

An interesting consequence of the fact that $\mathsf{Weq}(\U) \rightarrow \U \times \U$ is fibrant is that for any cofibrant object $X$, given two maps $f_1,f_2:X \rightrightarrows \U$ and a homotopy $h:\Delta[1] \times X \rightarrow \U$ from $f_1$ to $f_2$, them there is a weak equivalence in $\SSet_{/X}$ between the object classified by $f_1$ and $f_2$. Indeed, it is constructed as follows, one first take a lift:

\[\xymatrix{ X \ar[r]^{i_1} \ar[d]^{\delta^0} & \mathsf{Weq}(\U) \ar@{->>}[d] \\
\Delta[1] \times X \ar[r]^{(f_1,h)} \ar@{.>}[ur] & \U \times \U
}\]

Where $i_1$ denotes a map classyfing the identify of the object classified by $f_1$, and by $f_1$ in the first component of the bottom arrow we mean the composite $\Delta[1] \times X \rightarrow X \rightarrow \U$. Composing the dotted arrow with $\delta^1$ gives us a map $X \rightarrow  \mathsf{Weq}(\U)$ whose projection to $\U \times \U$ if $(f_1,f_2)$, i.e. it classifies a weak equivalence between the objects classified by $f_1$ and $f_2$. Note that one can do the exact same thing with $\delta^0$ and $\delta^1$ exchanged to get a weak equivalence in the other direction.


We are now ready to prove that $\U$ is fibrant. Consider any map $\Lambda^k[n] \rightarrow \U $, it classifies a certain to a cofibrant object $V \twoheadrightarrow \Lambda^k[n]$.

As mentioned in \ref{lemma:genTcof_strongHequiv}, all $\Lambda^k [n] \hookrightarrow \Delta[n]$ are strong $k$-oriented homotopy equivalence, i.e. this can be extended by the retract diagram (where the precise maps depends on if $k<n$ or $k>0$):

\[\xymatrix{\Lambda^k[n] \ar[d] \ar[r] & \Delta[1] \times \Lambda^k[n] \cup \Delta[n] \ar[d] \ar[r] & \Lambda^k[n] \ar[d] \ar[r] & \U \\
\Delta[n] \ar[r] & \Delta[1] \times \Delta[n] \ar[r] & \Delta[n] 
}\]



By the observation above, the map $\Delta[1] \times \Lambda^k[n] \cup \Delta[n] \rightarrow \U$ in the diagram gives a solid diagram as:

\[ 
\xymatrix{
  V
  \ar@{.>}[rr]
  \ar[dr]^{\sim}
  \ar@{->>}[dd]
&&
  W
  \ar@{.>}[dr]^{\sim}
  \ar@{.>>}[dd]|{\hole}
&\\&
  E
  \ar[rr]
  \ar@{->>}[dl]
&&
  F
  \ar@{->>}[dl]
\\
  \Lambda^k[n]
  \ar@{^{(}->}[rr]^i
&&
  \Delta[n]
&
}
\] 


So one can construct an object $W$ fibrant and cofibrant over $\Delta[n]$ whose pullback to $\lambda^k[n]$ is (isomorphic to) $V$. The map $\Delta[n] \rightarrow \U$ classying the object gives the lift we are looking for (more precisely, one can use $W$ to construct  a map $\Delta[n] \rightarrow \U$ which extend the one we started from and which classifies something isormophic to $W$). \qedhere
\end{enumerate}
\end{proof}



\newpage

\section{Conclusions and outlook}
\label{sec:conout}

We now discuss our second aim, namely showing how we can build on \cref{thm:restricted-frobenius} 
to define sufficient structure to interpret $\Pi$-types. This is not immediate since the result of applying $\Pi_p$ to a 
fibration with cofibrant domain need not have cofibrant domain.
 Suppose that we have fibrations 
$q \co B \to A$ and~$p \co A \to X$, with
all objects both fibrant and cofibrant. 
We begin by applying 
\[
\Pi_p  \co \SSet_{/A} \to \SSet_{/X}
\]
to $q \co B \to A$, so as to obtain $\Pi_p(q) \co \Pi_A(B) \to X$, which is
a fibration by~\cref{thm:restricted-frobenius}. The domain of this map is fibrant but
not necessarily cofibrant, so we consider its cofibrant replacement 
\[
\widetilde{\Pi}_A(B) \defeq \mathbb{L} \big( \Pi_A(B)  \big) \, ,
\]
which comes equipped with a trivial fibration $\varepsilon \co \widetilde{\Pi}_A(B) \to \Pi_A(B)$.
Finally, we define the fibration $\widetilde{\Pi}_p(q) \co \widetilde{\Pi}_A(B) \to X$ as 
 the composite
 \[
\xymatrix{
\widetilde{\Pi}_A(B) \ar[rr]^{\varepsilon} \ar[dr]_{\widetilde{\Pi}_p(q) } & & \Pi_A(B) \ar[dl]^{\Pi_p(q)}  \\
 & X &} 
 \]
This will satisfy the $\beta$-rule but not the $\eta$-rule for $\Pi$-types [TO BE ADDED].




\begin{itemize}
\item This should be essentially straightforward, following Kapulkin and Lumsdaine, but we may need to modify the notion of a $\Pi$-structure to accommodate the cofibrant replacements that we take for $\Pi$.
\end{itemize}

\appendix

\section{Weak model structures} 

Let $\cal{E}$ be a category with an initial object $0$. A {\bf class of cofibrations} in $\cal{E}$ is
a class of maps $\Cof$ of $\cal{E}$ with the following properties:
\begin{enumerate}[(C1)]
\item $\Cof$ contains identities and is closed under composition;
\item For all $i \co A \to B$ in $\Cof$, $A$ is cofibrant;
\item For all $i \co A \to B$ in $\Cof$ and $f \co A \to A'$ with $A'$ cofibrant, there is a pushout
\[
\xymatrix{
A \ar[r]^f \ar[d]_{i}  & A' \ar[d] \\
B \ar[r] & \ulpullback B }
\]
with $A' \to B'$ in $\Cof$.
\item Isomorphisms whose domain is cofibrant are in $\Cof$.
\end{enumerate}
There is a dual notion of a class of fibrations in a category with a terminal object, which we do
not spell out.

\medskip

Let now $\cal{E}$ be a category with both an initial object $0$ and a terminal object $1$,
a class of cofibrations $\Cof$ and a class of fibrations $\Fib$. We say that a map is a {\bf trivial fibration}
if it is a fibration and it has the right lifting property with respect to all cofibrations. Dually, we say that
a map is a {\bf trivial cofibration} if it is a cofibration and it has the left lifting property with respect to
all fibrations. An object is said to be {\bf bifibrant} if it is both fibrant and cofibrant.


\begin{definition} A {\bf semi-model structure} on $\cal{E}$ consists of a class of cofibrations $\Cof$, a class of
fibrations $\Fib$ such that
\begin{enumerate}[(SM1)]
\item Every map $f \co A \to X$, where $A$ is cofibrant and $X$ is fibrant, factors both as a
cofibration followed by a trivial fibration and as a trivial cofibration followed by a trivial fibration.
\item For every bifibrant object $X$, we have a factorisation of the codiagonal $\nabla_X \co 
X + X \to X$ as a cofibration followed by a fibration 
\[
\xymatrix{X + X \ar[r] &  {\bf I}(X) \ar[r] & X}
\]
such that the composites 
\[
\xymatrix{X \ar[r]^-{\iota_k}  & X+X \ar[r] & {\bf I }(X)}
\]
are trivial cofibrations.
\item For every bifibrant object $X$, we have a factorisation of the diagonal $\Delta_X \co X \to 
X \times X$ as a cofibration followed by a fibration
\[
\xymatrix{X  \ar[r]  & {\bf P}(X) \ar[r] & X \times X }
 \]
 such that the composites
\[
\xymatrix{ {\bf P}(X) \ar[r] &  X \times X \ar[r]^-{\pi_k} &  X }
\]
are trivial fibrations.
\end{enumerate}
\end{definition}

\bigskip



It is important to note the similarities and differences between semi-model structures and model
structures. 



\nocite{*}





\bibliographystyle{plain}
\bibliography{../Auxiliary/bibliography}

\end{document}



